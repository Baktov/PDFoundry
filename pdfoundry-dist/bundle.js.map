{"version":3,"sources":["node_modules/browser-pack/_prelude.js","src/module/api/PDFoundryAPI.ts","src/module/app/PDFItemSheet.ts","src/module/cache/PDFCache.ts","src/module/main.ts","src/module/settings/PDFLocalization.ts","src/module/settings/PDFSettings.ts","src/module/viewer/PDFViewerBase.ts","src/module/viewer/PDFViewerWeb.ts"],"names":[],"mappings":"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","file":"bundle.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()","/* Copyright 2020 Andrew Cuccinello\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *     http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\nimport { PDFSettings } from '../settings/PDFSettings';\r\nimport { PDFViewerWeb } from '../viewer/PDFViewerWeb';\r\n\r\nexport class PDFoundryAPIError extends Error {\r\n    constructor(message?: string) {\r\n        super(message);\r\n    }\r\n}\r\n\r\n/**\r\n * All the properties of a PDF that can be specified by a user\r\n */\r\nexport type PDFData = {\r\n    code: string;\r\n    url: string;\r\n    offset: number;\r\n    cache: boolean;\r\n};\r\n\r\nexport class PDFoundryAPI {\r\n    /**\r\n     * Register your system with the API.\r\n     * @param system The module YOU are calling this from.\r\n     */\r\n    public static async registerSystem(system: string) {\r\n        PDFSettings.EXTERNAL_SYSTEM_NAME = system;\r\n    }\r\n\r\n    /**\r\n     * Get an object containing the user specified PDF data for a specific PDF code.\r\n     * @param code\r\n     */\r\n    public static getPDFData(code: string): null | PDFData {\r\n        const entity = game.items.find((item) => {\r\n            return item.data.type === PDFSettings.PDF_ENTITY_TYPE && item.data.data.code === code;\r\n        });\r\n        if (entity === undefined || entity === null) {\r\n            return null;\r\n        }\r\n\r\n        const data = entity.data.data;\r\n        if (data.offset === '') {\r\n            data.offset = 0;\r\n        }\r\n        data.offset = parseInt(data.offset);\r\n        return data;\r\n    }\r\n\r\n    /**\r\n     * Open a PDF by code to the specified page.\r\n     * @param code\r\n     * @param page\r\n     */\r\n    public static open(code: string, page: number = 1) {\r\n        const pdf = this.getPDFData(code);\r\n        if (pdf === null) {\r\n            throw new PDFoundryAPIError(`Unable to find a PDF with the code \"${code}. Did the user declare it?`);\r\n        }\r\n\r\n        const { url, offset } = pdf;\r\n        // coerce to number; safety first\r\n        page = offset + parseInt(page.toString());\r\n\r\n        this.openURL(`${window.origin}/${url}`, page);\r\n    }\r\n\r\n    /**\r\n     * Open a PDF by URL to the specified page.\r\n     * @param url\r\n     * @param page\r\n     */\r\n    public static openURL(url: string, page: number = 1) {\r\n        if (url === undefined) {\r\n            throw new PDFoundryAPIError('Unable to open PDF; \"url\" must be defined');\r\n        }\r\n\r\n        // coerce to number; safety first\r\n        page = parseInt(page.toString());\r\n        if (isNaN(page) || page <= 0) {\r\n            throw new PDFoundryAPIError(`Page must be > 0 but ${page} was given.`);\r\n        }\r\n\r\n        new PDFViewerWeb(url, page).render(true);\r\n    }\r\n}\r\n","/* Copyright 2020 Andrew Cuccinello\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *     http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\nimport { PDFSettings } from '../settings/PDFSettings';\r\nimport { PDFoundryAPI } from '../api/PDFoundryAPI';\r\n/**\r\n * Extends the base ItemSheet for linked PDF viewing.\r\n */\r\nexport class PDFSourceSheet extends ItemSheet {\r\n    static get defaultOptions() {\r\n        const options = super.defaultOptions;\r\n        options.classes = ['sheet', 'item'];\r\n        options.width = 650;\r\n        options.height = 'auto';\r\n        return options;\r\n    }\r\n\r\n    get template() {\r\n        return `systems/${PDFSettings.EXTERNAL_SYSTEM_NAME}/${PDFSettings.DIST_FOLDER}/templates/pdf-sheet.html`;\r\n    }\r\n\r\n    /**\r\n     * Helper method to get a id in the html form\r\n     * html ids are prepended with the id of the item to preserve uniqueness\r\n     *  which is mandatory to allow multiple forms to be open\r\n     * @param html\r\n     * @param id\r\n     */\r\n    private getByID(html: JQuery<HTMLElement>, id: string) {\r\n        return html.parent().parent().find(`#${this.item._id}-${id}`);\r\n    }\r\n\r\n    protected activateListeners(html: JQuery<HTMLElement>): void {\r\n        super.activateListeners(html);\r\n\r\n        this.addGithubLink(html);\r\n\r\n        const urlInput = this.getByID(html, 'data\\\\.url');\r\n        const offsetInput = this.getByID(html, 'data\\\\.offset');\r\n\r\n        // Block enter from displaying the PDF\r\n        html.find('input').on('keypress', function (event) {\r\n            if (event.key === 'Enter') {\r\n                event.preventDefault();\r\n            }\r\n        });\r\n\r\n        console.log(this.getByID(html, 'pdf-test'));\r\n\r\n        // Test button\r\n        this.getByID(html, 'pdf-test').on('click', function (event) {\r\n            event.preventDefault();\r\n\r\n            let urlValue = urlInput.val();\r\n            let offsetValue = offsetInput.val();\r\n\r\n            if (urlValue === null || urlValue === undefined) return;\r\n            if (offsetValue === null || offsetValue === undefined) return;\r\n\r\n            urlValue = `${window.location.origin}/${urlValue}`;\r\n\r\n            if (offsetValue.toString().trim() === '') {\r\n                offsetValue = 0;\r\n            }\r\n            offsetValue = parseInt(offsetValue as string);\r\n\r\n            PDFoundryAPI.openURL(urlValue, 5 + offsetValue);\r\n        });\r\n\r\n        // Browse button\r\n        this.getByID(html, 'pdf-browse').on('click', async function (event) {\r\n            event.preventDefault();\r\n\r\n            const fp = new FilePicker({});\r\n            // @ts-ignore TODO: foundry-pc-types\r\n            fp.extensions = ['.pdf'];\r\n            fp.field = urlInput[0];\r\n\r\n            let urlValue = urlInput.val();\r\n            if (urlValue !== undefined) {\r\n                await fp.browse(urlValue.toString().trim());\r\n            }\r\n\r\n            fp.render(true);\r\n        });\r\n    }\r\n\r\n    protected addGithubLink(html: JQuery<HTMLElement>) {\r\n        const h4 = html.parent().parent().find('header.window-header h4.window-title');\r\n        const next = h4.next()[0].childNodes[1].textContent;\r\n        if (next && next.trim() === 'PDFoundry') {\r\n            return;\r\n        }\r\n\r\n        const url = 'https://github.com/Djphoenix719/PDFoundry';\r\n        const style = 'text-decoration: none';\r\n        const icon = '<i class=\"fas fa-external-link-alt\"></i>';\r\n        const link = $(`<a style=\"${style}\" href=\"${url}\">${icon} PDFoundry</a>`);\r\n\r\n        h4.after(link);\r\n    }\r\n}\r\n","/* Copyright 2020 Andrew Cuccinello\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *     http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nimport { PDFViewerBase } from '../viewer/PDFViewerBase';\r\nimport { PDFSettings } from '../settings/PDFSettings';\r\n\r\n/**\r\n * An error thrown when a caching operation fails.\r\n */\r\nexport class PDFCacheError extends Error {\r\n    constructor(message?: string) {\r\n        super(message);\r\n    }\r\n}\r\n\r\n/**\r\n * Handles caching for PDFs\r\n */\r\nexport class PDFCache {\r\n    // <editor-fold desc=\"Static Properties\">\r\n    /**\r\n     * Max size of the cache, defaults to 256 MB.\r\n     */\r\n    public static MAX_BYTES: number = 256 * 2 ** 20;\r\n\r\n    private static readonly IDB_NAME: string = PDFSettings.INTERNAL_MODULE_NAME;\r\n    private static readonly IDB_VERSION: number = 1;\r\n    private static readonly IDB_STORE_NAME: string = `Cache`;\r\n\r\n    private static _idb: IDBDatabase;\r\n    // </editor-fold>\r\n\r\n    // <editor-fold desc=\"'Shims'\">\r\n    /**\r\n     * Helper to standardize IndexDB...\r\n     * https://xkcd.com/927/\r\n     */\r\n    private static get IDBFactory(): IDBFactory {\r\n        // @ts-ignore\r\n        return window.indexedDB || window.webkitIndexedDB || window.mozIndexedDB || window.OIndexedDB || window.msIndexedDB;\r\n    }\r\n\r\n    /**\r\n     * Helper to standardize idbTransaction...\r\n     * https://xkcd.com/927/\r\n     */\r\n    private static get IDBTransaction(): IDBTransaction {\r\n        // @ts-ignore\r\n        return window.IDBTransaction || window.webkitIDBTransaction || window.OIDBTransaction || window.msIDBTransaction;\r\n    }\r\n    // </editor-fold>\r\n\r\n    /**\r\n     * Helper to get a new transaction\r\n     */\r\n    private static getTransaction() {\r\n        return this._idb.transaction(PDFCache.IDB_STORE_NAME, 'readwrite');\r\n    }\r\n\r\n    /**\r\n     * Helper to get the store for a transaction, reduces boilerplate.\r\n     * @param transaction The transaction to fetch the store for\r\n     */\r\n    private static getStore(transaction: IDBTransaction) {\r\n        return transaction.objectStore(PDFCache.IDB_STORE_NAME);\r\n    }\r\n\r\n    /**\r\n     * Commit the value to a specified key in the indexed db\r\n     * @param key The key to use as an index\r\n     * @param data The data to insert\r\n     * @param force If true, will delete an existing object at the specified key,\r\n     *  if one exists. Defaults to false.\r\n     */\r\n    public static async commit(key: IDBValidKey, data: Uint8Array, force: boolean = false): Promise<void> {\r\n        if (this._idb) {\r\n            let transaction = this.getTransaction();\r\n\r\n            // Propagate errors upwards, otherwise they fail silently\r\n            transaction.onerror = function (event) {\r\n                // @ts-ignore\r\n                throw event.target.error;\r\n            };\r\n\r\n            let store = this.getStore(transaction);\r\n            const keyRequest = store.getKey(key);\r\n            keyRequest.onsuccess = function (event) {\r\n                // if key exists in the store\r\n                if (keyRequest.result) {\r\n                    // should we force the new value by deleting the old?\r\n                    if (force) {\r\n                        PDFCache.delete(key).then(() => {\r\n                            // Deleting something will end our transaction\r\n                            // So we reacquire a new transaction\r\n                            transaction = PDFCache.getTransaction();\r\n                            store = PDFCache.getStore(transaction);\r\n\r\n                            store.add(data, key);\r\n                        });\r\n                    } else {\r\n                        throw new PDFCacheError(`Error in commit, ${key} already exists`);\r\n                    }\r\n                } else {\r\n                    store.add(data, key);\r\n                }\r\n            };\r\n        } else {\r\n            throw new PDFCacheError('Error in commit, IDB not initialized');\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Delete an object stored in the indexed db at the specified location\r\n     * @param key\r\n     */\r\n    public static delete(key: IDBValidKey): Promise<void> {\r\n        // This *should* be an async method because I use async everywhere else\r\n        // But I find this type of logic easier to interpret with a promise pattern\r\n        //   since the resolve/rejects happen inside callbacks\r\n        return new Promise<void>((resolve, reject) => {\r\n            try {\r\n                const transaction = this.getTransaction();\r\n                const store = this.getStore(transaction);\r\n\r\n                transaction.onerror = function (event) {\r\n                    // @ts-ignore\r\n                    reject(event.target.error);\r\n                };\r\n                transaction.oncomplete = function (event) {\r\n                    resolve();\r\n                };\r\n\r\n                store.delete(key);\r\n            } catch (error) {\r\n                reject(error);\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Clear all cached files.\r\n     */\r\n    public static clear(): Promise<void> {\r\n        return new Promise<void>((resolve, reject) => {\r\n            try {\r\n                const transaction = this.getTransaction();\r\n                const store = this.getStore(transaction);\r\n                const keys = store.getAllKeys();\r\n                keys.onsuccess = (result) => {\r\n                    const promises: Promise<void>[] = [];\r\n                    for (const key of keys.result) {\r\n                        promises.push(PDFCache.delete(key));\r\n                    }\r\n\r\n                    Promise.all(promises).then(() => {\r\n                        resolve();\r\n                    });\r\n                };\r\n            } catch (error) {\r\n                reject(error);\r\n            }\r\n        });\r\n    }\r\n\r\n    public static async initialize() {\r\n        //TODO: Handle errors\r\n        const request = PDFCache.IDBFactory.open(PDFCache.IDB_NAME, PDFCache.IDB_VERSION);\r\n        request.onsuccess = function (event) {\r\n            PDFCache._idb = this.result;\r\n            PDFCache.cache('modules/djs-data/sr5-books/Shadowrun - Assassins Primer.pdf');\r\n            PDFCache.cache('modules/djs-data/sr5-books/Shadowrun - Core Rulebook.pdf');\r\n            PDFCache.cache('modules/djs-data/sr5-books/Shadowrun - Run Faster.pdf');\r\n        };\r\n        request.onupgradeneeded = function (event) {\r\n            PDFCache._idb = this.result;\r\n            try {\r\n                // Create object store if it doesn't exist\r\n                PDFCache._idb.createObjectStore(PDFCache.IDB_STORE_NAME, {});\r\n            } catch (error) {\r\n                // Otherwise pass\r\n            }\r\n        };\r\n    }\r\n\r\n    public static async cache(source: PDFViewerBase | string) {\r\n        if (typeof source === 'string') {\r\n            return this._cacheURI(source);\r\n        } else {\r\n            return this._cacheViewer(source);\r\n        }\r\n    }\r\n\r\n    private static async _cacheURI(uri: string): Promise<boolean> {\r\n        const response = await fetch(uri);\r\n        const data = new Uint8Array(await response.arrayBuffer());\r\n        await PDFCache.commit(uri, data, true);\r\n        return true;\r\n    }\r\n\r\n    private static async _cacheViewer(viewer: PDFViewerBase): Promise<boolean> {\r\n        return Promise.reject();\r\n    }\r\n}\r\n","/* Copyright 2020 Andrew Cuccinello\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *     http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\nimport { PDFoundryAPI } from './api/PDFoundryAPI';\r\nimport { PDFSettings } from './settings/PDFSettings';\r\nimport { PDFLocalization } from './settings/PDFLocalization';\r\nimport { PDFCache } from './cache/PDFCache';\r\n\r\nHooks.once('init', function () {\r\n    // @ts-ignore\r\n    ui.PDFoundry = PDFoundryAPI;\r\n});\r\nHooks.once('init', PDFSettings.registerSettings);\r\n\r\nHooks.once('ready', async function () {\r\n    await PDFLocalization.init();\r\n});\r\nHooks.once('ready', PDFSettings.registerPDFSheet);\r\nHooks.once('ready', PDFSettings.injectCSS);\r\n\r\nHooks.once('ready', () => {\r\n    let viewed = false;\r\n    try {\r\n        const help = game.settings.get(PDFSettings.INTERNAL_MODULE_NAME, 'help');\r\n        viewed = help.viewed;\r\n    } catch (error) {}\r\n\r\n    if (!viewed) {\r\n        PDFSettings.showHelp();\r\n    }\r\n});\r\n\r\nHooks.on('preCreateItem', PDFSettings.preCreateItem);\r\nHooks.on('getItemDirectoryEntryContext', PDFSettings.getItemContextOptions);\r\nHooks.on('renderSettings', PDFSettings.onRenderSettings);\r\n\r\n// Initialize PDF cache\r\nHooks.once('setup', PDFCache.initialize);\r\n","/* Copyright 2020 Andrew Cuccinello\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *     http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\nimport { PDFSettings } from './PDFSettings';\r\n\r\n/**\r\n * Localization helper\r\n */\r\nexport class PDFLocalization {\r\n    /**\r\n     * Load the localization file for the user's language.\r\n     */\r\n    public static async init() {\r\n        const lang = game.i18n.lang;\r\n        // user's language path\r\n        const u_path = `systems/${PDFSettings.EXTERNAL_SYSTEM_NAME}/${PDFSettings.DIST_FOLDER}/locale/${lang}/config.json`;\r\n        // english fallback path\r\n        const f_path = `systems/${PDFSettings.EXTERNAL_SYSTEM_NAME}/${PDFSettings.DIST_FOLDER}/locale/en/config.json`;\r\n\r\n        let json;\r\n        try {\r\n            json = await $.getJSON(u_path);\r\n        } catch (error) {\r\n            // if no translation exits for the users locale the fallback\r\n            json = await $.getJSON(f_path);\r\n        }\r\n\r\n        for (const key of Object.keys(json)) {\r\n            game.i18n.translations[key] = json[key];\r\n        }\r\n\r\n        // setup the fallback as english so partial translations do not display keys\r\n        let fb_json = await $.getJSON(f_path);\r\n        for (const key of Object.keys(fb_json)) {\r\n            // @ts-ignore\r\n            game.i18n._fallback[key] = json[key];\r\n        }\r\n    }\r\n}\r\n","/* Copyright 2020 Andrew Cuccinello\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *     http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\nimport { PDFSourceSheet } from '../app/PDFItemSheet';\r\nimport { PDFoundryAPI } from '../api/PDFoundryAPI';\r\nimport { PDFLog } from '../log/PDFLog';\r\n\r\n/**\r\n * Internal settings and helper methods for PDFoundry.\r\n */\r\nexport class PDFSettings {\r\n    public static DIST_FOLDER: string = 'pdfoundry-dist';\r\n    public static EXTERNAL_SYSTEM_NAME: string = '../modules/pdfoundry';\r\n    public static INTERNAL_MODULE_NAME: string = 'PDFoundry';\r\n    public static PDF_ENTITY_TYPE: string = 'PDFoundry_PDF';\r\n\r\n    /**\r\n     * Register the PDF sheet and unregister invalid sheet types from it.\r\n     */\r\n    public static registerPDFSheet() {\r\n        //  static unregisterSheet(scope, sheetClass, {types=[]}={}) {\r\n        Items.unregisterSheet(PDFSettings.INTERNAL_MODULE_NAME, 'SR5ItemSheet', {\r\n            types: [PDFSettings.PDF_ENTITY_TYPE],\r\n        });\r\n        Items.registerSheet(PDFSettings.INTERNAL_MODULE_NAME, PDFSourceSheet, {\r\n            types: [PDFSettings.PDF_ENTITY_TYPE],\r\n            makeDefault: true,\r\n        });\r\n\r\n        // Unregister all other item sheets for the PDF entity\r\n        const pdfoundryKey = `${PDFSettings.INTERNAL_MODULE_NAME}.${PDFSourceSheet.name}`;\r\n        const sheets = CONFIG.Item.sheetClasses[PDFSettings.PDF_ENTITY_TYPE];\r\n        for (const key of Object.keys(sheets)) {\r\n            const sheet = sheets[key];\r\n            // keep the PDFoundry sheet\r\n            if (sheet.id === pdfoundryKey) {\r\n                continue;\r\n            }\r\n\r\n            // id is MODULE.CLASS_NAME\r\n            const [module] = sheet.id.split('.');\r\n            Items.unregisterSheet(module, sheet.cls, {\r\n                types: [PDFSettings.PDF_ENTITY_TYPE],\r\n            });\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Setup default values for pdf entities\r\n     * @param entity\r\n     * @param args ignored args\r\n     */\r\n    public static async preCreateItem(entity, ...args) {\r\n        if (entity.type !== PDFSettings.PDF_ENTITY_TYPE) {\r\n            return;\r\n        }\r\n        entity.img = `systems/${PDFSettings.EXTERNAL_SYSTEM_NAME}/${PDFSettings.DIST_FOLDER}/assets/pdf_icon.svg`;\r\n    }\r\n\r\n    /**\r\n     * Helper method to grab the id from the html object and return an item\r\n     * @param html\r\n     */\r\n    private static getItemFromContext(html: JQuery<HTMLElement>): Item {\r\n        const id = html.data('entity-id');\r\n        return game.items.get(id);\r\n    }\r\n\r\n    /**\r\n     * Get additional context menu icons for PDF items\r\n     * @param html\r\n     * @param options\r\n     */\r\n    public static getItemContextOptions(html, options: any[]) {\r\n        options.splice(0, 0, {\r\n            name: game.i18n.localize('PDFOUNDRY.CONTEXT.OpenPDF'),\r\n            icon: '<i class=\"far fa-file-pdf\"></i>',\r\n            condition: (entityHtml: JQuery<HTMLElement>) => {\r\n                const item = PDFSettings.getItemFromContext(entityHtml);\r\n                if (item.type !== PDFSettings.PDF_ENTITY_TYPE) {\r\n                    return false;\r\n                }\r\n\r\n                const { code, url } = item.data.data;\r\n                return code !== '' && url !== '';\r\n            },\r\n            callback: (entityHtml: JQuery<HTMLElement>) => {\r\n                const item = PDFSettings.getItemFromContext(entityHtml);\r\n                const { code } = item.data.data;\r\n                PDFoundryAPI.open(code);\r\n            },\r\n        });\r\n    }\r\n\r\n    public static injectCSS() {\r\n        $('head').append(\r\n            $(`<link href=\"systems/${PDFSettings.EXTERNAL_SYSTEM_NAME}/${PDFSettings.DIST_FOLDER}/bundle.css\" rel=\"stylesheet\" type=\"text/css\" media=\"all\">`),\r\n        );\r\n    }\r\n\r\n    public static registerSettings() {\r\n        // Has an individual user viewed the manual yet?\r\n        game.settings.register(PDFSettings.INTERNAL_MODULE_NAME, 'help', {\r\n            viewed: false,\r\n            scope: 'user',\r\n        });\r\n    }\r\n\r\n    public static onRenderSettings(settings: any, html: JQuery<HTMLElement>, data: any) {\r\n        const icon = '<i class=\"far fa-file-pdf\"></i>';\r\n        const button = $(`<button>${icon} ${game.i18n.localize('PDFOUNDRY.SETTINGS.OpenHelp')}</button>`);\r\n        button.on('click', PDFSettings.showHelp);\r\n\r\n        html.find('h2').last().before(button);\r\n    }\r\n\r\n    public static async showHelp() {\r\n        await game.settings.set(PDFSettings.INTERNAL_MODULE_NAME, 'help', {\r\n            viewed: true,\r\n        });\r\n\r\n        PDFoundryAPI.openURL(`${window.origin}/systems/${PDFSettings.EXTERNAL_SYSTEM_NAME}/${PDFSettings.DIST_FOLDER}/assets/PDFoundry Manual.pdf`);\r\n    }\r\n}\r\n","/* Copyright 2020 Andrew Cuccinello\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *     http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\nimport { PDFCache } from '../cache/PDFCache';\r\n\r\nexport class PDFViewerBase extends Application {\r\n    protected _frame: HTMLIFrameElement;\r\n\r\n    public get app() {\r\n        // @ts-ignore\r\n        return this._frame.contentWindow.PDFViewerApplication;\r\n    }\r\n\r\n    static get defaultOptions() {\r\n        const options = super.defaultOptions;\r\n        options.id = 'pdf-viewer';\r\n        options.classes = ['app', 'window-app'];\r\n        options.title = 'View PDF';\r\n        options.width = 8.5 * 100 + 64;\r\n        options.height = 11 * 100 + 64;\r\n        options.resizable = true;\r\n        return options;\r\n    }\r\n\r\n    protected async activateListeners(html: JQuery<HTMLElement>): Promise<void> {\r\n        super.activateListeners(html);\r\n\r\n        this._frame = html.parents().find('iframe.pdfViewer').first().get(0) as HTMLIFrameElement;\r\n\r\n        // @ts-ignore\r\n        window.viewer = this;\r\n    }\r\n\r\n    /**\r\n     * Attempt to safely cleanup PDFjs to avoid memory leaks.\r\n     */\r\n    protected cleanup(): void {\r\n        if (this._frame && this._frame.contentWindow) {\r\n            const window = this._frame.contentWindow;\r\n            // @ts-ignore\r\n            window.PDFViewerApplication.cleanup();\r\n        }\r\n    }\r\n\r\n    close(): Promise<any> {\r\n        this.cleanup();\r\n        return super.close();\r\n    }\r\n}\r\n","/* Copyright 2020 Andrew Cuccinello\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *     http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\nimport { PDFViewerBase } from './PDFViewerBase';\r\nimport { PDFSettings } from '../settings/PDFSettings';\r\n\r\nexport class PDFViewerWeb extends PDFViewerBase {\r\n    private m_Page: number;\r\n    private m_FilePath: string;\r\n\r\n    static get defaultOptions() {\r\n        const options = super.defaultOptions;\r\n        options.template = `systems/${PDFSettings.EXTERNAL_SYSTEM_NAME}/pdfoundry-dist/templates/web-viewer-app.html`;\r\n        return options;\r\n    }\r\n\r\n    constructor(file: string, page: number) {\r\n        super();\r\n\r\n        this.m_FilePath = encodeURIComponent(file);\r\n        this.m_Page = page;\r\n    }\r\n\r\n    getData(options?: any): any | Promise<any> {\r\n        const data = super.getData(options);\r\n        data.page = this.m_Page;\r\n        data.filePath = this.m_FilePath;\r\n        data.systemName = PDFSettings.EXTERNAL_SYSTEM_NAME;\r\n        return data;\r\n    }\r\n}\r\n"],"preExistingComment":"//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvbW9kdWxlL2FwaS9QREZvdW5kcnlBUEkudHMiLCJzcmMvbW9kdWxlL2FwcC9QREZJdGVtU2hlZXQudHMiLCJzcmMvbW9kdWxlL2NhY2hlL1BERkNhY2hlLnRzIiwic3JjL21vZHVsZS9tYWluLnRzIiwic3JjL21vZHVsZS9zZXR0aW5ncy9QREZMb2NhbGl6YXRpb24udHMiLCJzcmMvbW9kdWxlL3NldHRpbmdzL1BERlNldHRpbmdzLnRzIiwic3JjL21vZHVsZS92aWV3ZXIvUERGVmlld2VyQmFzZS50cyIsInNyYy9tb2R1bGUvdmlld2VyL1BERlZpZXdlcldlYi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7QUNBQTs7Ozs7Ozs7Ozs7OztHQWFHOzs7Ozs7Ozs7Ozs7QUFFSCx5REFBc0Q7QUFDdEQseURBQXNEO0FBRXRELE1BQWEsaUJBQWtCLFNBQVEsS0FBSztJQUN4QyxZQUFZLE9BQWdCO1FBQ3hCLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUNuQixDQUFDO0NBQ0o7QUFKRCw4Q0FJQztBQVlELE1BQWEsWUFBWTtJQUNyQjs7O09BR0c7SUFDSSxNQUFNLENBQU8sY0FBYyxDQUFDLE1BQWM7O1lBQzdDLHlCQUFXLENBQUMsb0JBQW9CLEdBQUcsTUFBTSxDQUFDO1FBQzlDLENBQUM7S0FBQTtJQUVEOzs7T0FHRztJQUNJLE1BQU0sQ0FBQyxVQUFVLENBQUMsSUFBWTtRQUNqQyxNQUFNLE1BQU0sR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDLElBQUksRUFBRSxFQUFFO1lBQ3BDLE9BQU8sSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLEtBQUsseUJBQVcsQ0FBQyxlQUFlLElBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxLQUFLLElBQUksQ0FBQztRQUMxRixDQUFDLENBQUMsQ0FBQztRQUNILElBQUksTUFBTSxL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Ozs7Ozs7Ozs7R0FhRzs7O0FBRUgsbURBQWdEO0FBQ2hELHlEQUFzRDtBQUV0RCxNQUFhLFlBQWEsU0FBUSw2QkFBYTtJQVUzQyxZQUFZLElBQVksRUFBRSxJQUFZO1FBQ2xDLEtBQUssRUFBRSxDQUFDO1FBRVIsSUFBSSxDQUFDLFVBQVUsR0FBRyxrQkFBa0IsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUMzQyxJQUFJLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQztJQUN2QixDQUFDO0lBWEQsTUFBTSxLQUFLLGNBQWM7UUFDckIsTUFBTSxPQUFPLEdBQUcsS0FBSyxDQUFDLGNBQWMsQ0FBQztRQUNyQyxPQUFPLENBQUMsUUFBUSxHQUFHLFdBQVcseUJBQVcsQ0FBQyxvQkFBb0IsK0NBQStDLENBQUM7UUFDOUcsT0FBTyxPQUFPLENBQUM7SUFDbkIsQ0FBQztJQVNELE9BQU8sQ0FBQyxPQUFhO1FBQ2pCLE1BQU0sSUFBSSxHQUFHLEtBQUssQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDcEMsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDO1FBQ3hCLElBQUksQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDLFVBQVUsQ0FBQztRQUNoQyxJQUFJLENBQUMsVUFBVSxHQUFHLHlCQUFXLENBQUMsb0JBQW9CLENBQUM7UUFDbkQsT0FBTyxJQUFJLENBQUM7SUFDaEIsQ0FBQztDQUNKO0FBeEJELG9DQXdCQyIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uKCl7ZnVuY3Rpb24gcihlLG4sdCl7ZnVuY3Rpb24gbyhpLGYpe2lmKCFuW2ldKXtpZighZVtpXSl7dmFyIGM9XCJmdW5jdGlvblwiPT10eXBlb2YgcmVxdWlyZSYmcmVxdWlyZTtpZighZiYmYylyZXR1cm4gYyhpLCEwKTtpZih1KXJldHVybiB1KGksITApO3ZhciBhPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIraStcIidcIik7dGhyb3cgYS5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGF9dmFyIHA9bltpXT17ZXhwb3J0czp7fX07ZVtpXVswXS5jYWxsKHAuZXhwb3J0cyxmdW5jdGlvbihyKXt2YXIgbj1lW2ldWzFdW3JdO3JldHVybiBvKG58fHIpfSxwLHAuZXhwb3J0cyxyLGUsbix0KX1yZXR1cm4gbltpXS5leHBvcnRzfWZvcih2YXIgdT1cImZ1bmN0aW9uXCI9PXR5cGVvZiByZXF1aXJlJiZyZXF1aXJlLGk9MDtpPHQubGVuZ3RoO2krKylvKHRbaV0pO3JldHVybiBvfXJldHVybiByfSkoKSIsIi8qIENvcHlyaWdodCAyMDIwIEFuZHJldyBDdWNjaW5lbGxvXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuXHJcbmltcG9ydCB7IFBERlNldHRpbmdzIH0gZnJvbSAnLi4vc2V0dGluZ3MvUERGU2V0dGluZ3MnO1xyXG5pbXBvcnQgeyBQREZWaWV3ZXJXZWIgfSBmcm9tICcuLi92aWV3ZXIvUERGVmlld2VyV2ViJztcclxuXHJcbmV4cG9ydCBjbGFzcyBQREZvdW5kcnlBUElFcnJvciBleHRlbmRzIEVycm9yIHtcclxuICAgIGNvbnN0cnVjdG9yKG1lc3NhZ2U/OiBzdHJpbmcpIHtcclxuICAgICAgICBzdXBlcihtZXNzYWdlKTtcclxuICAgIH1cclxufVxyXG5cclxuLyoqXHJcbiAqIEFsbCB0aGUgcHJvcGVydGllcyBvZiBhIFBERiB0aGF0IGNhbiBiZSBzcGVjaWZpZWQgYnkgYSB1c2VyXHJcbiAqL1xyXG5leHBvcnQgdHlwZSBQREZEYXRhID0ge1xyXG4gICAgY29kZTogc3RyaW5nO1xyXG4gICAgdXJsOiBzdHJpbmc7XHJcbiAgICBvZmZzZXQ6IG51bWJlcjtcclxuICAgIGNhY2hlOiBib29sZWFuO1xyXG59O1xyXG5cclxuZXhwb3J0IGNsYXNzIFBERm91bmRyeUFQSSB7XHJcbiAgICAvKipcclxuICAgICAqIFJlZ2lzdGVyIHlvdXIgc3lzdGVtIHdpdGggdGhlIEFQSS5cclxuICAgICAqIEBwYXJhbSBzeXN0ZW0gVGhlIG1vZHVsZSBZT1UgYXJlIGNhbGxpbmcgdGhpcyBmcm9tLlxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgc3RhdGljIGFzeW5jIHJlZ2lzdGVyU3lzdGVtKHN5c3RlbTogc3RyaW5nKSB7XHJcbiAgICAgICAgUERGU2V0dGluZ3MuRVhURVJOQUxfU1lTVEVNX05BTUUgPSBzeXN0ZW07XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBHZXQgYW4gb2JqZWN0IGNvbnRhaW5pbmcgdGhlIHVzZXIgc3BlY2lmaWVkIFBERiBkYXRhIGZvciBhIHNwZWNpZmljIFBERiBjb2RlLlxyXG4gICAgICogQHBhcmFtIGNvZGVcclxuICAgICAqL1xyXG4gICAgcHVibGljIHN0YXRpYyBnZXRQREZEYXRhKGNvZGU6IHN0cmluZyk6IG51bGwgfCBQREZEYXRhIHtcclxuICAgICAgICBjb25zdCBlbnRpdHkgPSBnYW1lLml0ZW1zLmZpbmQoKGl0ZW0pID0+IHtcclxuICAgICAgICAgICAgcmV0dXJuIGl0ZW0uZGF0YS50eXBlID09PSBQREZTZXR0aW5ncy5QREZfRU5USVRZX1RZUEUgJiYgaXRlbS5kYXRhLmRhdGEuY29kZSA9PT0gY29kZTtcclxuICAgICAgICB9KTtcclxuICAgICAgICBpZiAoZW50aXR5ID09PSB1bmRlZmluZWQgfHwgZW50aXR5ID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgZGF0YSA9IGVudGl0eS5kYXRhLmRhdGE7XHJcbiAgICAgICAgaWYgKGRhdGEub2Zmc2V0ID09PSAnJykge1xyXG4gICAgICAgICAgICBkYXRhLm9mZnNldCA9IDA7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGRhdGEub2Zmc2V0ID0gcGFyc2VJbnQoZGF0YS5vZmZzZXQpO1xyXG4gICAgICAgIHJldHVybiBkYXRhO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogT3BlbiBhIFBERiBieSBjb2RlIHRvIHRoZSBzcGVjaWZpZWQgcGFnZS5cclxuICAgICAqIEBwYXJhbSBjb2RlXHJcbiAgICAgKiBAcGFyYW0gcGFnZVxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgc3RhdGljIG9wZW4oY29kZTogc3RyaW5nLCBwYWdlOiBudW1iZXIgPSAxKSB7XHJcbiAgICAgICAgY29uc3QgcGRmID0gdGhpcy5nZXRQREZEYXRhKGNvZGUpO1xyXG4gICAgICAgIGlmIChwZGYgPT09IG51bGwpIHtcclxuICAgICAgICAgICAgdGhyb3cgbmV3IFBERm91bmRyeUFQSUVycm9yKGBVbmFibGUgdG8gZmluZCBhIFBERiB3aXRoIHRoZSBjb2RlIFwiJHtjb2RlfS4gRGlkIHRoZSB1c2VyIGRlY2xhcmUgaXQ/YCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCB7IHVybCwgb2Zmc2V0IH0gPSBwZGY7XHJcbiAgICAgICAgLy8gY29lcmNlIHRvIG51bWJlcjsgc2FmZXR5IGZpcnN0XHJcbiAgICAgICAgcGFnZSA9IG9mZnNldCArIHBhcnNlSW50KHBhZ2UudG9TdHJpbmcoKSk7XHJcblxyXG4gICAgICAgIHRoaXMub3BlblVSTChgJHt3aW5kb3cub3JpZ2lufS8ke3VybH1gLCBwYWdlKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIE9wZW4gYSBQREYgYnkgVVJMIHRvIHRoZSBzcGVjaWZpZWQgcGFnZS5cclxuICAgICAqIEBwYXJhbSB1cmxcclxuICAgICAqIEBwYXJhbSBwYWdlXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBzdGF0aWMgb3BlblVSTCh1cmw6IHN0cmluZywgcGFnZTogbnVtYmVyID0gMSkge1xyXG4gICAgICAgIGlmICh1cmwgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgUERGb3VuZHJ5QVBJRXJyb3IoJ1VuYWJsZSB0byBvcGVuIFBERjsgXCJ1cmxcIiBtdXN0IGJlIGRlZmluZWQnKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIGNvZXJjZSB0byBudW1iZXI7IHNhZmV0eSBmaXJzdFxyXG4gICAgICAgIHBhZ2UgPSBwYXJzZUludChwYWdlLnRvU3RyaW5nKCkpO1xyXG4gICAgICAgIGlmIChpc05hTihwYWdlKSB8fCBwYWdlIDw9IDApIHtcclxuICAgICAgICAgICAgdGhyb3cgbmV3IFBERm91bmRyeUFQSUVycm9yKGBQYWdlIG11c3QgYmUgPiAwIGJ1dCAke3BhZ2V9IHdhcyBnaXZlbi5gKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIG5ldyBQREZWaWV3ZXJXZWIodXJsLCBwYWdlKS5yZW5kZXIodHJ1ZSk7XHJcbiAgICB9XHJcbn1cclxuIiwiLyogQ29weXJpZ2h0IDIwMjAgQW5kcmV3IEN1Y2NpbmVsbG9cclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG5cclxuaW1wb3J0IHsgUERGU2V0dGluZ3MgfSBmcm9tICcuLi9zZXR0aW5ncy9QREZTZXR0aW5ncyc7XHJcbmltcG9ydCB7IFBERm91bmRyeUFQSSB9IGZyb20gJy4uL2FwaS9QREZvdW5kcnlBUEknO1xyXG4vKipcclxuICogRXh0ZW5kcyB0aGUgYmFzZSBJdGVtU2hlZXQgZm9yIGxpbmtlZCBQREYgdmlld2luZy5cclxuICovXHJcbmV4cG9ydCBjbGFzcyBQREZTb3VyY2VTaGVldCBleHRlbmRzIEl0ZW1TaGVldCB7XHJcbiAgICBzdGF0aWMgZ2V0IGRlZmF1bHRPcHRpb25zKCkge1xyXG4gICAgICAgIGNvbnN0IG9wdGlvbnMgPSBzdXBlci5kZWZhdWx0T3B0aW9ucztcclxuICAgICAgICBvcHRpb25zLmNsYXNzZXMgPSBbJ3NoZWV0JywgJ2l0ZW0nXTtcclxuICAgICAgICBvcHRpb25zLndpZHRoID0gNjUwO1xyXG4gICAgICAgIG9wdGlvbnMuaGVpZ2h0ID0gJ2F1dG8nO1xyXG4gICAgICAgIHJldHVybiBvcHRpb25zO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCB0ZW1wbGF0ZSgpIHtcclxuICAgICAgICByZXR1cm4gYHN5c3RlbXMvJHtQREZTZXR0aW5ncy5FWFRFUk5BTF9TWVNURU1fTkFNRX0vJHtQREZTZXR0aW5ncy5ESVNUX0ZPTERFUn0vdGVtcGxhdGVzL3BkZi1zaGVldC5odG1sYDtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEhlbHBlciBtZXRob2QgdG8gZ2V0IGEgaWQgaW4gdGhlIGh0bWwgZm9ybVxyXG4gICAgICogaHRtbCBpZHMgYXJlIHByZXBlbmRlZCB3aXRoIHRoZSBpZCBvZiB0aGUgaXRlbSB0byBwcmVzZXJ2ZSB1bmlxdWVuZXNzXHJcbiAgICAgKiAgd2hpY2ggaXMgbWFuZGF0b3J5IHRvIGFsbG93IG11bHRpcGxlIGZvcm1zIHRvIGJlIG9wZW5cclxuICAgICAqIEBwYXJhbSBodG1sXHJcbiAgICAgKiBAcGFyYW0gaWRcclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSBnZXRCeUlEKGh0bWw6IEpRdWVyeTxIVE1MRWxlbWVudD4sIGlkOiBzdHJpbmcpIHtcclxuICAgICAgICByZXR1cm4gaHRtbC5wYXJlbnQoKS5wYXJlbnQoKS5maW5kKGAjJHt0aGlzLml0ZW0uX2lkfS0ke2lkfWApO1xyXG4gICAgfVxyXG5cclxuICAgIHByb3RlY3RlZCBhY3RpdmF0ZUxpc3RlbmVycyhodG1sOiBKUXVlcnk8SFRNTEVsZW1lbnQ+KTogdm9pZCB7XHJcbiAgICAgICAgc3VwZXIuYWN0aXZhdGVMaXN0ZW5lcnMoaHRtbCk7XHJcblxyXG4gICAgICAgIHRoaXMuYWRkR2l0aHViTGluayhodG1sKTtcclxuXHJcbiAgICAgICAgY29uc3QgdXJsSW5wdXQgPSB0aGlzLmdldEJ5SUQoaHRtbCwgJ2RhdGFcXFxcLnVybCcpO1xyXG4gICAgICAgIGNvbnN0IG9mZnNldElucHV0ID0gdGhpcy5nZXRCeUlEKGh0bWwsICdkYXRhXFxcXC5vZmZzZXQnKTtcclxuXHJcbiAgICAgICAgLy8gQmxvY2sgZW50ZXIgZnJvbSBkaXNwbGF5aW5nIHRoZSBQREZcclxuICAgICAgICBodG1sLmZpbmQoJ2lucHV0Jykub24oJ2tleXByZXNzJywgZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAgICAgICAgIGlmIChldmVudC5rZXkgPT09ICdFbnRlcicpIHtcclxuICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgY29uc29sZS5sb2codGhpcy5nZXRCeUlEKGh0bWwsICdwZGYtdGVzdCcpKTtcclxuXHJcbiAgICAgICAgLy8gVGVzdCBidXR0b25cclxuICAgICAgICB0aGlzLmdldEJ5SUQoaHRtbCwgJ3BkZi10ZXN0Jykub24oJ2NsaWNrJywgZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcblxyXG4gICAgICAgICAgICBsZXQgdXJsVmFsdWUgPSB1cmxJbnB1dC52YWwoKTtcclxuICAgICAgICAgICAgbGV0IG9mZnNldFZhbHVlID0gb2Zmc2V0SW5wdXQudmFsKCk7XHJcblxyXG4gICAgICAgICAgICBpZiAodXJsVmFsdWUgPT09IG51bGwgfHwgdXJsVmFsdWUgPT09IHVuZGVmaW5lZCkgcmV0dXJuO1xyXG4gICAgICAgICAgICBpZiAob2Zmc2V0VmFsdWUgPT09IG51bGwgfHwgb2Zmc2V0VmFsdWUgPT09IHVuZGVmaW5lZCkgcmV0dXJuO1xyXG5cclxuICAgICAgICAgICAgdXJsVmFsdWUgPSBgJHt3aW5kb3cubG9jYXRpb24ub3JpZ2lufS8ke3VybFZhbHVlfWA7XHJcblxyXG4gICAgICAgICAgICBpZiAob2Zmc2V0VmFsdWUudG9TdHJpbmcoKS50cmltKCkgPT09ICcnKSB7XHJcbiAgICAgICAgICAgICAgICBvZmZzZXRWYWx1ZSA9IDA7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgb2Zmc2V0VmFsdWUgPSBwYXJzZUludChvZmZzZXRWYWx1ZSBhcyBzdHJpbmcpO1xyXG5cclxuICAgICAgICAgICAgUERGb3VuZHJ5QVBJLm9wZW5VUkwodXJsVmFsdWUsIDUgKyBvZmZzZXRWYWx1ZSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIC8vIEJyb3dzZSBidXR0b25cclxuICAgICAgICB0aGlzLmdldEJ5SUQoaHRtbCwgJ3BkZi1icm93c2UnKS5vbignY2xpY2snLCBhc3luYyBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IGZwID0gbmV3IEZpbGVQaWNrZXIoe30pO1xyXG4gICAgICAgICAgICAvLyBAdHMtaWdub3JlIFRPRE86IGZvdW5kcnktcGMtdHlwZXNcclxuICAgICAgICAgICAgZnAuZXh0ZW5zaW9ucyA9IFsnLnBkZiddO1xyXG4gICAgICAgICAgICBmcC5maWVsZCA9IHVybElucHV0WzBdO1xyXG5cclxuICAgICAgICAgICAgbGV0IHVybFZhbHVlID0gdXJsSW5wdXQudmFsKCk7XHJcbiAgICAgICAgICAgIGlmICh1cmxWYWx1ZSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICBhd2FpdCBmcC5icm93c2UodXJsVmFsdWUudG9TdHJpbmcoKS50cmltKCkpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBmcC5yZW5kZXIodHJ1ZSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJvdGVjdGVkIGFkZEdpdGh1YkxpbmsoaHRtbDogSlF1ZXJ5PEhUTUxFbGVtZW50Pikge1xyXG4gICAgICAgIGNvbnN0IGg0ID0gaHRtbC5wYXJlbnQoKS5wYXJlbnQoKS5maW5kKCdoZWFkZXIud2luZG93LWhlYWRlciBoNC53aW5kb3ctdGl0bGUnKTtcclxuICAgICAgICBjb25zdCBuZXh0ID0gaDQubmV4dCgpWzBdLmNoaWxkTm9kZXNbMV0udGV4dENvbnRlbnQ7XHJcbiAgICAgICAgaWYgKG5leHQgJiYgbmV4dC50cmltKCkgPT09ICdQREZvdW5kcnknKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IHVybCA9ICdodHRwczovL2dpdGh1Yi5jb20vRGpwaG9lbml4NzE5L1BERm91bmRyeSc7XHJcbiAgICAgICAgY29uc3Qgc3R5bGUgPSAndGV4dC1kZWNvcmF0aW9uOiBub25lJztcclxuICAgICAgICBjb25zdCBpY29uID0gJzxpIGNsYXNzPVwiZmFzIGZhLWV4dGVybmFsLWxpbmstYWx0XCI+PC9pPic7XHJcbiAgICAgICAgY29uc3QgbGluayA9ICQoYDxhIHN0eWxlPVwiJHtzdHlsZX1cIiBocmVmPVwiJHt1cmx9XCI+JHtpY29ufSBQREZvdW5kcnk8L2E+YCk7XHJcblxyXG4gICAgICAgIGg0LmFmdGVyKGxpbmspO1xyXG4gICAgfVxyXG59XHJcbiIsIi8qIENvcHlyaWdodCAyMDIwIEFuZHJldyBDdWNjaW5lbGxvXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuaW1wb3J0IHsgUERGVmlld2VyQmFzZSB9IGZyb20gJy4uL3ZpZXdlci9QREZWaWV3ZXJCYXNlJztcclxuaW1wb3J0IHsgUERGU2V0dGluZ3MgfSBmcm9tICcuLi9zZXR0aW5ncy9QREZTZXR0aW5ncyc7XHJcblxyXG4vKipcclxuICogQW4gZXJyb3IgdGhyb3duIHdoZW4gYSBjYWNoaW5nIG9wZXJhdGlvbiBmYWlscy5cclxuICovXHJcbmV4cG9ydCBjbGFzcyBQREZDYWNoZUVycm9yIGV4dGVuZHMgRXJyb3Ige1xyXG4gICAgY29uc3RydWN0b3IobWVzc2FnZT86IHN0cmluZykge1xyXG4gICAgICAgIHN1cGVyKG1lc3NhZ2UpO1xyXG4gICAgfVxyXG59XHJcblxyXG4vKipcclxuICogSGFuZGxlcyBjYWNoaW5nIGZvciBQREZzXHJcbiAqL1xyXG5leHBvcnQgY2xhc3MgUERGQ2FjaGUge1xyXG4gICAgLy8gPGVkaXRvci1mb2xkIGRlc2M9XCJTdGF0aWMgUHJvcGVydGllc1wiPlxyXG4gICAgLyoqXHJcbiAgICAgKiBNYXggc2l6ZSBvZiB0aGUgY2FjaGUsIGRlZmF1bHRzIHRvIDI1NiBNQi5cclxuICAgICAqL1xyXG4gICAgcHVibGljIHN0YXRpYyBNQVhfQllURVM6IG51bWJlciA9IDI1NiAqIDIgKiogMjA7XHJcblxyXG4gICAgcHJpdmF0ZSBzdGF0aWMgcmVhZG9ubHkgSURCX05BTUU6IHN0cmluZyA9IFBERlNldHRpbmdzLklOVEVSTkFMX01PRFVMRV9OQU1FO1xyXG4gICAgcHJpdmF0ZSBzdGF0aWMgcmVhZG9ubHkgSURCX1ZFUlNJT046IG51bWJlciA9IDE7XHJcbiAgICBwcml2YXRlIHN0YXRpYyByZWFkb25seSBJREJfU1RPUkVfTkFNRTogc3RyaW5nID0gYENhY2hlYDtcclxuXHJcbiAgICBwcml2YXRlIHN0YXRpYyBfaWRiOiBJREJEYXRhYmFzZTtcclxuICAgIC8vIDwvZWRpdG9yLWZvbGQ+XHJcblxyXG4gICAgLy8gPGVkaXRvci1mb2xkIGRlc2M9XCInU2hpbXMnXCI+XHJcbiAgICAvKipcclxuICAgICAqIEhlbHBlciB0byBzdGFuZGFyZGl6ZSBJbmRleERCLi4uXHJcbiAgICAgKiBodHRwczovL3hrY2QuY29tLzkyNy9cclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSBzdGF0aWMgZ2V0IElEQkZhY3RvcnkoKTogSURCRmFjdG9yeSB7XHJcbiAgICAgICAgLy8gQHRzLWlnbm9yZVxyXG4gICAgICAgIHJldHVybiB3aW5kb3cuaW5kZXhlZERCIHx8IHdpbmRvdy53ZWJraXRJbmRleGVkREIgfHwgd2luZG93Lm1vekluZGV4ZWREQiB8fCB3aW5kb3cuT0luZGV4ZWREQiB8fCB3aW5kb3cubXNJbmRleGVkREI7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBIZWxwZXIgdG8gc3RhbmRhcmRpemUgaWRiVHJhbnNhY3Rpb24uLi5cclxuICAgICAqIGh0dHBzOi8veGtjZC5jb20vOTI3L1xyXG4gICAgICovXHJcbiAgICBwcml2YXRlIHN0YXRpYyBnZXQgSURCVHJhbnNhY3Rpb24oKTogSURCVHJhbnNhY3Rpb24ge1xyXG4gICAgICAgIC8vIEB0cy1pZ25vcmVcclxuICAgICAgICByZXR1cm4gd2luZG93LklEQlRyYW5zYWN0aW9uIHx8IHdpbmRvdy53ZWJraXRJREJUcmFuc2FjdGlvbiB8fCB3aW5kb3cuT0lEQlRyYW5zYWN0aW9uIHx8IHdpbmRvdy5tc0lEQlRyYW5zYWN0aW9uO1xyXG4gICAgfVxyXG4gICAgLy8gPC9lZGl0b3ItZm9sZD5cclxuXHJcbiAgICAvKipcclxuICAgICAqIEhlbHBlciB0byBnZXQgYSBuZXcgdHJhbnNhY3Rpb25cclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSBzdGF0aWMgZ2V0VHJhbnNhY3Rpb24oKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2lkYi50cmFuc2FjdGlvbihQREZDYWNoZS5JREJfU1RPUkVfTkFNRSwgJ3JlYWR3cml0ZScpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogSGVscGVyIHRvIGdldCB0aGUgc3RvcmUgZm9yIGEgdHJhbnNhY3Rpb24sIHJlZHVjZXMgYm9pbGVycGxhdGUuXHJcbiAgICAgKiBAcGFyYW0gdHJhbnNhY3Rpb24gVGhlIHRyYW5zYWN0aW9uIHRvIGZldGNoIHRoZSBzdG9yZSBmb3JcclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSBzdGF0aWMgZ2V0U3RvcmUodHJhbnNhY3Rpb246IElEQlRyYW5zYWN0aW9uKSB7XHJcbiAgICAgICAgcmV0dXJuIHRyYW5zYWN0aW9uLm9iamVjdFN0b3JlKFBERkNhY2hlLklEQl9TVE9SRV9OQU1FKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIENvbW1pdCB0aGUgdmFsdWUgdG8gYSBzcGVjaWZpZWQga2V5IGluIHRoZSBpbmRleGVkIGRiXHJcbiAgICAgKiBAcGFyYW0ga2V5IFRoZSBrZXkgdG8gdXNlIGFzIGFuIGluZGV4XHJcbiAgICAgKiBAcGFyYW0gZGF0YSBUaGUgZGF0YSB0byBpbnNlcnRcclxuICAgICAqIEBwYXJhbSBmb3JjZSBJZiB0cnVlLCB3aWxsIGRlbGV0ZSBhbiBleGlzdGluZyBvYmplY3QgYXQgdGhlIHNwZWNpZmllZCBrZXksXHJcbiAgICAgKiAgaWYgb25lIGV4aXN0cy4gRGVmYXVsdHMgdG8gZmFsc2UuXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBzdGF0aWMgYXN5bmMgY29tbWl0KGtleTogSURCVmFsaWRLZXksIGRhdGE6IFVpbnQ4QXJyYXksIGZvcmNlOiBib29sZWFuID0gZmFsc2UpOiBQcm9taXNlPHZvaWQ+IHtcclxuICAgICAgICBpZiAodGhpcy5faWRiKSB7XHJcbiAgICAgICAgICAgIGxldCB0cmFuc2FjdGlvbiA9IHRoaXMuZ2V0VHJhbnNhY3Rpb24oKTtcclxuXHJcbiAgICAgICAgICAgIC8vIFByb3BhZ2F0ZSBlcnJvcnMgdXB3YXJkcywgb3RoZXJ3aXNlIHRoZXkgZmFpbCBzaWxlbnRseVxyXG4gICAgICAgICAgICB0cmFuc2FjdGlvbi5vbmVycm9yID0gZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAgICAgICAgICAgICAvLyBAdHMtaWdub3JlXHJcbiAgICAgICAgICAgICAgICB0aHJvdyBldmVudC50YXJnZXQuZXJyb3I7XHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICBsZXQgc3RvcmUgPSB0aGlzLmdldFN0b3JlKHRyYW5zYWN0aW9uKTtcclxuICAgICAgICAgICAgY29uc3Qga2V5UmVxdWVzdCA9IHN0b3JlLmdldEtleShrZXkpO1xyXG4gICAgICAgICAgICBrZXlSZXF1ZXN0Lm9uc3VjY2VzcyA9IGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgICAgICAgICAgICAgLy8gaWYga2V5IGV4aXN0cyBpbiB0aGUgc3RvcmVcclxuICAgICAgICAgICAgICAgIGlmIChrZXlSZXF1ZXN0LnJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIHNob3VsZCB3ZSBmb3JjZSB0aGUgbmV3IHZhbHVlIGJ5IGRlbGV0aW5nIHRoZSBvbGQ/XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZvcmNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFBERkNhY2hlLmRlbGV0ZShrZXkpLnRoZW4oKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gRGVsZXRpbmcgc29tZXRoaW5nIHdpbGwgZW5kIG91ciB0cmFuc2FjdGlvblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU28gd2UgcmVhY3F1aXJlIGEgbmV3IHRyYW5zYWN0aW9uXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmFuc2FjdGlvbiA9IFBERkNhY2hlLmdldFRyYW5zYWN0aW9uKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdG9yZSA9IFBERkNhY2hlLmdldFN0b3JlKHRyYW5zYWN0aW9uKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdG9yZS5hZGQoZGF0YSwga2V5KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFBERkNhY2hlRXJyb3IoYEVycm9yIGluIGNvbW1pdCwgJHtrZXl9IGFscmVhZHkgZXhpc3RzYCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBzdG9yZS5hZGQoZGF0YSwga2V5KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgUERGQ2FjaGVFcnJvcignRXJyb3IgaW4gY29tbWl0LCBJREIgbm90IGluaXRpYWxpemVkJyk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogRGVsZXRlIGFuIG9iamVjdCBzdG9yZWQgaW4gdGhlIGluZGV4ZWQgZGIgYXQgdGhlIHNwZWNpZmllZCBsb2NhdGlvblxyXG4gICAgICogQHBhcmFtIGtleVxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgc3RhdGljIGRlbGV0ZShrZXk6IElEQlZhbGlkS2V5KTogUHJvbWlzZTx2b2lkPiB7XHJcbiAgICAgICAgLy8gVGhpcyAqc2hvdWxkKiBiZSBhbiBhc3luYyBtZXRob2QgYmVjYXVzZSBJIHVzZSBhc3luYyBldmVyeXdoZXJlIGVsc2VcclxuICAgICAgICAvLyBCdXQgSSBmaW5kIHRoaXMgdHlwZSBvZiBsb2dpYyBlYXNpZXIgdG8gaW50ZXJwcmV0IHdpdGggYSBwcm9taXNlIHBhdHRlcm5cclxuICAgICAgICAvLyAgIHNpbmNlIHRoZSByZXNvbHZlL3JlamVjdHMgaGFwcGVuIGluc2lkZSBjYWxsYmFja3NcclxuICAgICAgICByZXR1cm4gbmV3IFByb21pc2U8dm9pZD4oKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgdHJhbnNhY3Rpb24gPSB0aGlzLmdldFRyYW5zYWN0aW9uKCk7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBzdG9yZSA9IHRoaXMuZ2V0U3RvcmUodHJhbnNhY3Rpb24pO1xyXG5cclxuICAgICAgICAgICAgICAgIHRyYW5zYWN0aW9uLm9uZXJyb3IgPSBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBAdHMtaWdub3JlXHJcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGV2ZW50LnRhcmdldC5lcnJvcik7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgdHJhbnNhY3Rpb24ub25jb21wbGV0ZSA9IGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUoKTtcclxuICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgc3RvcmUuZGVsZXRlKGtleSk7XHJcbiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICByZWplY3QoZXJyb3IpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBDbGVhciBhbGwgY2FjaGVkIGZpbGVzLlxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgc3RhdGljIGNsZWFyKCk6IFByb21pc2U8dm9pZD4ge1xyXG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZTx2b2lkPigocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCB0cmFuc2FjdGlvbiA9IHRoaXMuZ2V0VHJhbnNhY3Rpb24oKTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHN0b3JlID0gdGhpcy5nZXRTdG9yZSh0cmFuc2FjdGlvbik7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBrZXlzID0gc3RvcmUuZ2V0QWxsS2V5cygpO1xyXG4gICAgICAgICAgICAgICAga2V5cy5vbnN1Y2Nlc3MgPSAocmVzdWx0KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcHJvbWlzZXM6IFByb21pc2U8dm9pZD5bXSA9IFtdO1xyXG4gICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3Qga2V5IG9mIGtleXMucmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHByb21pc2VzLnB1c2goUERGQ2FjaGUuZGVsZXRlKGtleSkpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgUHJvbWlzZS5hbGwocHJvbWlzZXMpLnRoZW4oKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgICAgICAgICAgcmVqZWN0KGVycm9yKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBzdGF0aWMgYXN5bmMgaW5pdGlhbGl6ZSgpIHtcclxuICAgICAgICAvL1RPRE86IEhhbmRsZSBlcnJvcnNcclxuICAgICAgICBjb25zdCByZXF1ZXN0ID0gUERGQ2FjaGUuSURCRmFjdG9yeS5vcGVuKFBERkNhY2hlLklEQl9OQU1FLCBQREZDYWNoZS5JREJfVkVSU0lPTik7XHJcbiAgICAgICAgcmVxdWVzdC5vbnN1Y2Nlc3MgPSBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgICAgICAgICAgUERGQ2FjaGUuX2lkYiA9IHRoaXMucmVzdWx0O1xyXG4gICAgICAgICAgICBQREZDYWNoZS5jYWNoZSgnbW9kdWxlcy9kanMtZGF0YS9zcjUtYm9va3MvU2hhZG93cnVuIC0gQXNzYXNzaW5zIFByaW1lci5wZGYnKTtcclxuICAgICAgICAgICAgUERGQ2FjaGUuY2FjaGUoJ21vZHVsZXMvZGpzLWRhdGEvc3I1LWJvb2tzL1NoYWRvd3J1biAtIENvcmUgUnVsZWJvb2sucGRmJyk7XHJcbiAgICAgICAgICAgIFBERkNhY2hlLmNhY2hlKCdtb2R1bGVzL2Rqcy1kYXRhL3NyNS1ib29rcy9TaGFkb3dydW4gLSBSdW4gRmFzdGVyLnBkZicpO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgcmVxdWVzdC5vbnVwZ3JhZGVuZWVkZWQgPSBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgICAgICAgICAgUERGQ2FjaGUuX2lkYiA9IHRoaXMucmVzdWx0O1xyXG4gICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgLy8gQ3JlYXRlIG9iamVjdCBzdG9yZSBpZiBpdCBkb2Vzbid0IGV4aXN0XHJcbiAgICAgICAgICAgICAgICBQREZDYWNoZS5faWRiLmNyZWF0ZU9iamVjdFN0b3JlKFBERkNhY2hlLklEQl9TVE9SRV9OQU1FLCB7fSk7XHJcbiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBPdGhlcndpc2UgcGFzc1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgc3RhdGljIGFzeW5jIGNhY2hlKHNvdXJjZTogUERGVmlld2VyQmFzZSB8IHN0cmluZykge1xyXG4gICAgICAgIGlmICh0eXBlb2Ygc291cmNlID09PSAnc3RyaW5nJykge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fY2FjaGVVUkkoc291cmNlKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fY2FjaGVWaWV3ZXIoc291cmNlKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBzdGF0aWMgYXN5bmMgX2NhY2hlVVJJKHVyaTogc3RyaW5nKTogUHJvbWlzZTxib29sZWFuPiB7XHJcbiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaCh1cmkpO1xyXG4gICAgICAgIGNvbnN0IGRhdGEgPSBuZXcgVWludDhBcnJheShhd2FpdCByZXNwb25zZS5hcnJheUJ1ZmZlcigpKTtcclxuICAgICAgICBhd2FpdCBQREZDYWNoZS5jb21taXQodXJpLCBkYXRhLCB0cnVlKTtcclxuICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHN0YXRpYyBhc3luYyBfY2FjaGVWaWV3ZXIodmlld2VyOiBQREZWaWV3ZXJCYXNlKTogUHJvbWlzZTxib29sZWFuPiB7XHJcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KCk7XHJcbiAgICB9XHJcbn1cclxuIiwiLyogQ29weXJpZ2h0IDIwMjAgQW5kcmV3IEN1Y2NpbmVsbG9cclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG5cclxuaW1wb3J0IHsgUERGb3VuZHJ5QVBJIH0gZnJvbSAnLi9hcGkvUERGb3VuZHJ5QVBJJztcclxuaW1wb3J0IHsgUERGU2V0dGluZ3MgfSBmcm9tICcuL3NldHRpbmdzL1BERlNldHRpbmdzJztcclxuaW1wb3J0IHsgUERGTG9jYWxpemF0aW9uIH0gZnJvbSAnLi9zZXR0aW5ncy9QREZMb2NhbGl6YXRpb24nO1xyXG5pbXBvcnQgeyBQREZDYWNoZSB9IGZyb20gJy4vY2FjaGUvUERGQ2FjaGUnO1xyXG5cclxuSG9va3Mub25jZSgnaW5pdCcsIGZ1bmN0aW9uICgpIHtcclxuICAgIC8vIEB0cy1pZ25vcmVcclxuICAgIHVpLlBERm91bmRyeSA9IFBERm91bmRyeUFQSTtcclxufSk7XHJcbkhvb2tzLm9uY2UoJ2luaXQnLCBQREZTZXR0aW5ncy5yZWdpc3RlclNldHRpbmdzKTtcclxuXHJcbkhvb2tzLm9uY2UoJ3JlYWR5JywgYXN5bmMgZnVuY3Rpb24gKCkge1xyXG4gICAgYXdhaXQgUERGTG9jYWxpemF0aW9uLmluaXQoKTtcclxufSk7XHJcbkhvb2tzLm9uY2UoJ3JlYWR5JywgUERGU2V0dGluZ3MucmVnaXN0ZXJQREZTaGVldCk7XHJcbkhvb2tzLm9uY2UoJ3JlYWR5JywgUERGU2V0dGluZ3MuaW5qZWN0Q1NTKTtcclxuXHJcbkhvb2tzLm9uY2UoJ3JlYWR5JywgKCkgPT4ge1xyXG4gICAgbGV0IHZpZXdlZCA9IGZhbHNlO1xyXG4gICAgdHJ5IHtcclxuICAgICAgICBjb25zdCBoZWxwID0gZ2FtZS5zZXR0aW5ncy5nZXQoUERGU2V0dGluZ3MuSU5URVJOQUxfTU9EVUxFX05BTUUsICdoZWxwJyk7XHJcbiAgICAgICAgdmlld2VkID0gaGVscC52aWV3ZWQ7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge31cclxuXHJcbiAgICBpZiAoIXZpZXdlZCkge1xyXG4gICAgICAgIFBERlNldHRpbmdzLnNob3dIZWxwKCk7XHJcbiAgICB9XHJcbn0pO1xyXG5cclxuSG9va3Mub24oJ3ByZUNyZWF0ZUl0ZW0nLCBQREZTZXR0aW5ncy5wcmVDcmVhdGVJdGVtKTtcclxuSG9va3Mub24oJ2dldEl0ZW1EaXJlY3RvcnlFbnRyeUNvbnRleHQnLCBQREZTZXR0aW5ncy5nZXRJdGVtQ29udGV4dE9wdGlvbnMpO1xyXG5Ib29rcy5vbigncmVuZGVyU2V0dGluZ3MnLCBQREZTZXR0aW5ncy5vblJlbmRlclNldHRpbmdzKTtcclxuXHJcbi8vIEluaXRpYWxpemUgUERGIGNhY2hlXHJcbkhvb2tzLm9uY2UoJ3NldHVwJywgUERGQ2FjaGUuaW5pdGlhbGl6ZSk7XHJcbiIsIi8qIENvcHlyaWdodCAyMDIwIEFuZHJldyBDdWNjaW5lbGxvXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuXHJcbmltcG9ydCB7IFBERlNldHRpbmdzIH0gZnJvbSAnLi9QREZTZXR0aW5ncyc7XHJcblxyXG4vKipcclxuICogTG9jYWxpemF0aW9uIGhlbHBlclxyXG4gKi9cclxuZXhwb3J0IGNsYXNzIFBERkxvY2FsaXphdGlvbiB7XHJcbiAgICAvKipcclxuICAgICAqIExvYWQgdGhlIGxvY2FsaXphdGlvbiBmaWxlIGZvciB0aGUgdXNlcidzIGxhbmd1YWdlLlxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgc3RhdGljIGFzeW5jIGluaXQoKSB7XHJcbiAgICAgICAgY29uc3QgbGFuZyA9IGdhbWUuaTE4bi5sYW5nO1xyXG4gICAgICAgIC8vIHVzZXIncyBsYW5ndWFnZSBwYXRoXHJcbiAgICAgICAgY29uc3QgdV9wYXRoID0gYHN5c3RlbXMvJHtQREZTZXR0aW5ncy5FWFRFUk5BTF9TWVNURU1fTkFNRX0vJHtQREZTZXR0aW5ncy5ESVNUX0ZPTERFUn0vbG9jYWxlLyR7bGFuZ30vY29uZmlnLmpzb25gO1xyXG4gICAgICAgIC8vIGVuZ2xpc2ggZmFsbGJhY2sgcGF0aFxyXG4gICAgICAgIGNvbnN0IGZfcGF0aCA9IGBzeXN0ZW1zLyR7UERGU2V0dGluZ3MuRVhURVJOQUxfU1lTVEVNX05BTUV9LyR7UERGU2V0dGluZ3MuRElTVF9GT0xERVJ9L2xvY2FsZS9lbi9jb25maWcuanNvbmA7XHJcblxyXG4gICAgICAgIGxldCBqc29uO1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIGpzb24gPSBhd2FpdCAkLmdldEpTT04odV9wYXRoKTtcclxuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgICAgICAvLyBpZiBubyB0cmFuc2xhdGlvbiBleGl0cyBmb3IgdGhlIHVzZXJzIGxvY2FsZSB0aGUgZmFsbGJhY2tcclxuICAgICAgICAgICAganNvbiA9IGF3YWl0ICQuZ2V0SlNPTihmX3BhdGgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZm9yIChjb25zdCBrZXkgb2YgT2JqZWN0LmtleXMoanNvbikpIHtcclxuICAgICAgICAgICAgZ2FtZS5pMThuLnRyYW5zbGF0aW9uc1trZXldID0ganNvbltrZXldO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gc2V0dXAgdGhlIGZhbGxiYWNrIGFzIGVuZ2xpc2ggc28gcGFydGlhbCB0cmFuc2xhdGlvbnMgZG8gbm90IGRpc3BsYXkga2V5c1xyXG4gICAgICAgIGxldCBmYl9qc29uID0gYXdhaXQgJC5nZXRKU09OKGZfcGF0aCk7XHJcbiAgICAgICAgZm9yIChjb25zdCBrZXkgb2YgT2JqZWN0LmtleXMoZmJfanNvbikpIHtcclxuICAgICAgICAgICAgLy8gQHRzLWlnbm9yZVxyXG4gICAgICAgICAgICBnYW1lLmkxOG4uX2ZhbGxiYWNrW2tleV0gPSBqc29uW2tleV07XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbiIsIi8qIENvcHlyaWdodCAyMDIwIEFuZHJldyBDdWNjaW5lbGxvXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuXHJcbmltcG9ydCB7IFBERlNvdXJjZVNoZWV0IH0gZnJvbSAnLi4vYXBwL1BERkl0ZW1TaGVldCc7XHJcbmltcG9ydCB7IFBERm91bmRyeUFQSSB9IGZyb20gJy4uL2FwaS9QREZvdW5kcnlBUEknO1xyXG5pbXBvcnQgeyBQREZMb2cgfSBmcm9tICcuLi9sb2cvUERGTG9nJztcclxuXHJcbi8qKlxyXG4gKiBJbnRlcm5hbCBzZXR0aW5ncyBhbmQgaGVscGVyIG1ldGhvZHMgZm9yIFBERm91bmRyeS5cclxuICovXHJcbmV4cG9ydCBjbGFzcyBQREZTZXR0aW5ncyB7XHJcbiAgICBwdWJsaWMgc3RhdGljIERJU1RfRk9MREVSOiBzdHJpbmcgPSAncGRmb3VuZHJ5LWRpc3QnO1xyXG4gICAgcHVibGljIHN0YXRpYyBFWFRFUk5BTF9TWVNURU1fTkFNRTogc3RyaW5nID0gJy4uL21vZHVsZXMvcGRmb3VuZHJ5JztcclxuICAgIHB1YmxpYyBzdGF0aWMgSU5URVJOQUxfTU9EVUxFX05BTUU6IHN0cmluZyA9ICdQREZvdW5kcnknO1xyXG4gICAgcHVibGljIHN0YXRpYyBQREZfRU5USVRZX1RZUEU6IHN0cmluZyA9ICdQREZvdW5kcnlfUERGJztcclxuXHJcbiAgICAvKipcclxuICAgICAqIFJlZ2lzdGVyIHRoZSBQREYgc2hlZXQgYW5kIHVucmVnaXN0ZXIgaW52YWxpZCBzaGVldCB0eXBlcyBmcm9tIGl0LlxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgc3RhdGljIHJlZ2lzdGVyUERGU2hlZXQoKSB7XHJcbiAgICAgICAgLy8gIHN0YXRpYyB1bnJlZ2lzdGVyU2hlZXQoc2NvcGUsIHNoZWV0Q2xhc3MsIHt0eXBlcz1bXX09e30pIHtcclxuICAgICAgICBJdGVtcy51bnJlZ2lzdGVyU2hlZXQoUERGU2V0dGluZ3MuSU5URVJOQUxfTU9EVUxFX05BTUUsICdTUjVJdGVtU2hlZXQnLCB7XHJcbiAgICAgICAgICAgIHR5cGVzOiBbUERGU2V0dGluZ3MuUERGX0VOVElUWV9UWVBFXSxcclxuICAgICAgICB9KTtcclxuICAgICAgICBJdGVtcy5yZWdpc3RlclNoZWV0KFBERlNldHRpbmdzLklOVEVSTkFMX01PRFVMRV9OQU1FLCBQREZTb3VyY2VTaGVldCwge1xyXG4gICAgICAgICAgICB0eXBlczogW1BERlNldHRpbmdzLlBERl9FTlRJVFlfVFlQRV0sXHJcbiAgICAgICAgICAgIG1ha2VEZWZhdWx0OiB0cnVlLFxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICAvLyBVbnJlZ2lzdGVyIGFsbCBvdGhlciBpdGVtIHNoZWV0cyBmb3IgdGhlIFBERiBlbnRpdHlcclxuICAgICAgICBjb25zdCBwZGZvdW5kcnlLZXkgPSBgJHtQREZTZXR0aW5ncy5JTlRFUk5BTF9NT0RVTEVfTkFNRX0uJHtQREZTb3VyY2VTaGVldC5uYW1lfWA7XHJcbiAgICAgICAgY29uc3Qgc2hlZXRzID0gQ09ORklHLkl0ZW0uc2hlZXRDbGFzc2VzW1BERlNldHRpbmdzLlBERl9FTlRJVFlfVFlQRV07XHJcbiAgICAgICAgZm9yIChjb25zdCBrZXkgb2YgT2JqZWN0LmtleXMoc2hlZXRzKSkge1xyXG4gICAgICAgICAgICBjb25zdCBzaGVldCA9IHNoZWV0c1trZXldO1xyXG4gICAgICAgICAgICAvLyBrZWVwIHRoZSBQREZvdW5kcnkgc2hlZXRcclxuICAgICAgICAgICAgaWYgKHNoZWV0LmlkID09PSBwZGZvdW5kcnlLZXkpIHtcclxuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBpZCBpcyBNT0RVTEUuQ0xBU1NfTkFNRVxyXG4gICAgICAgICAgICBjb25zdCBbbW9kdWxlXSA9IHNoZWV0LmlkLnNwbGl0KCcuJyk7XHJcbiAgICAgICAgICAgIEl0ZW1zLnVucmVnaXN0ZXJTaGVldChtb2R1bGUsIHNoZWV0LmNscywge1xyXG4gICAgICAgICAgICAgICAgdHlwZXM6IFtQREZTZXR0aW5ncy5QREZfRU5USVRZX1RZUEVdLFxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBTZXR1cCBkZWZhdWx0IHZhbHVlcyBmb3IgcGRmIGVudGl0aWVzXHJcbiAgICAgKiBAcGFyYW0gZW50aXR5XHJcbiAgICAgKiBAcGFyYW0gYXJncyBpZ25vcmVkIGFyZ3NcclxuICAgICAqL1xyXG4gICAgcHVibGljIHN0YXRpYyBhc3luYyBwcmVDcmVhdGVJdGVtKGVudGl0eSwgLi4uYXJncykge1xyXG4gICAgICAgIGlmIChlbnRpdHkudHlwZSAhPT0gUERGU2V0dGluZ3MuUERGX0VOVElUWV9UWVBFKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgZW50aXR5LmltZyA9IGBzeXN0ZW1zLyR7UERGU2V0dGluZ3MuRVhURVJOQUxfU1lTVEVNX05BTUV9LyR7UERGU2V0dGluZ3MuRElTVF9GT0xERVJ9L2Fzc2V0cy9wZGZfaWNvbi5zdmdgO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogSGVscGVyIG1ldGhvZCB0byBncmFiIHRoZSBpZCBmcm9tIHRoZSBodG1sIG9iamVjdCBhbmQgcmV0dXJuIGFuIGl0ZW1cclxuICAgICAqIEBwYXJhbSBodG1sXHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgc3RhdGljIGdldEl0ZW1Gcm9tQ29udGV4dChodG1sOiBKUXVlcnk8SFRNTEVsZW1lbnQ+KTogSXRlbSB7XHJcbiAgICAgICAgY29uc3QgaWQgPSBodG1sLmRhdGEoJ2VudGl0eS1pZCcpO1xyXG4gICAgICAgIHJldHVybiBnYW1lLml0ZW1zLmdldChpZCk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBHZXQgYWRkaXRpb25hbCBjb250ZXh0IG1lbnUgaWNvbnMgZm9yIFBERiBpdGVtc1xyXG4gICAgICogQHBhcmFtIGh0bWxcclxuICAgICAqIEBwYXJhbSBvcHRpb25zXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBzdGF0aWMgZ2V0SXRlbUNvbnRleHRPcHRpb25zKGh0bWwsIG9wdGlvbnM6IGFueVtdKSB7XHJcbiAgICAgICAgb3B0aW9ucy5zcGxpY2UoMCwgMCwge1xyXG4gICAgICAgICAgICBuYW1lOiBnYW1lLmkxOG4ubG9jYWxpemUoJ1BERk9VTkRSWS5DT05URVhULk9wZW5QREYnKSxcclxuICAgICAgICAgICAgaWNvbjogJzxpIGNsYXNzPVwiZmFyIGZhLWZpbGUtcGRmXCI+PC9pPicsXHJcbiAgICAgICAgICAgIGNvbmRpdGlvbjogKGVudGl0eUh0bWw6IEpRdWVyeTxIVE1MRWxlbWVudD4pID0+IHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGl0ZW0gPSBQREZTZXR0aW5ncy5nZXRJdGVtRnJvbUNvbnRleHQoZW50aXR5SHRtbCk7XHJcbiAgICAgICAgICAgICAgICBpZiAoaXRlbS50eXBlICE9PSBQREZTZXR0aW5ncy5QREZfRU5USVRZX1RZUEUpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgY29uc3QgeyBjb2RlLCB1cmwgfSA9IGl0ZW0uZGF0YS5kYXRhO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGNvZGUgIT09ICcnICYmIHVybCAhPT0gJyc7XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGNhbGxiYWNrOiAoZW50aXR5SHRtbDogSlF1ZXJ5PEhUTUxFbGVtZW50PikgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgaXRlbSA9IFBERlNldHRpbmdzLmdldEl0ZW1Gcm9tQ29udGV4dChlbnRpdHlIdG1sKTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHsgY29kZSB9ID0gaXRlbS5kYXRhLmRhdGE7XHJcbiAgICAgICAgICAgICAgICBQREZvdW5kcnlBUEkub3Blbihjb2RlKTtcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgc3RhdGljIGluamVjdENTUygpIHtcclxuICAgICAgICAkKCdoZWFkJykuYXBwZW5kKFxyXG4gICAgICAgICAgICAkKGA8bGluayBocmVmPVwic3lzdGVtcy8ke1BERlNldHRpbmdzLkVYVEVSTkFMX1NZU1RFTV9OQU1FfS8ke1BERlNldHRpbmdzLkRJU1RfRk9MREVSfS9idW5kbGUuY3NzXCIgcmVsPVwic3R5bGVzaGVldFwiIHR5cGU9XCJ0ZXh0L2Nzc1wiIG1lZGlhPVwiYWxsXCI+YCksXHJcbiAgICAgICAgKTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgc3RhdGljIHJlZ2lzdGVyU2V0dGluZ3MoKSB7XHJcbiAgICAgICAgLy8gSGFzIGFuIGluZGl2aWR1YWwgdXNlciB2aWV3ZWQgdGhlIG1hbnVhbCB5ZXQ/XHJcbiAgICAgICAgZ2FtZS5zZXR0aW5ncy5yZWdpc3RlcihQREZTZXR0aW5ncy5JTlRFUk5BTF9NT0RVTEVfTkFNRSwgJ2hlbHAnLCB7XHJcbiAgICAgICAgICAgIHZpZXdlZDogZmFsc2UsXHJcbiAgICAgICAgICAgIHNjb3BlOiAndXNlcicsXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHN0YXRpYyBvblJlbmRlclNldHRpbmdzKHNldHRpbmdzOiBhbnksIGh0bWw6IEpRdWVyeTxIVE1MRWxlbWVudD4sIGRhdGE6IGFueSkge1xyXG4gICAgICAgIGNvbnN0IGljb24gPSAnPGkgY2xhc3M9XCJmYXIgZmEtZmlsZS1wZGZcIj48L2k+JztcclxuICAgICAgICBjb25zdCBidXR0b24gPSAkKGA8YnV0dG9uPiR7aWNvbn0gJHtnYW1lLmkxOG4ubG9jYWxpemUoJ1BERk9VTkRSWS5TRVRUSU5HUy5PcGVuSGVscCcpfTwvYnV0dG9uPmApO1xyXG4gICAgICAgIGJ1dHRvbi5vbignY2xpY2snLCBQREZTZXR0aW5ncy5zaG93SGVscCk7XHJcblxyXG4gICAgICAgIGh0bWwuZmluZCgnaDInKS5sYXN0KCkuYmVmb3JlKGJ1dHRvbik7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHN0YXRpYyBhc3luYyBzaG93SGVscCgpIHtcclxuICAgICAgICBhd2FpdCBnYW1lLnNldHRpbmdzLnNldChQREZTZXR0aW5ncy5JTlRFUk5BTF9NT0RVTEVfTkFNRSwgJ2hlbHAnLCB7XHJcbiAgICAgICAgICAgIHZpZXdlZDogdHJ1ZSxcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgUERGb3VuZHJ5QVBJLm9wZW5VUkwoYCR7d2luZG93Lm9yaWdpbn0vc3lzdGVtcy8ke1BERlNldHRpbmdzLkVYVEVSTkFMX1NZU1RFTV9OQU1FfS8ke1BERlNldHRpbmdzLkRJU1RfRk9MREVSfS9hc3NldHMvUERGb3VuZHJ5IE1hbnVhbC5wZGZgKTtcclxuICAgIH1cclxufVxyXG4iLCIvKiBDb3B5cmlnaHQgMjAyMCBBbmRyZXcgQ3VjY2luZWxsb1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcblxyXG5pbXBvcnQgeyBQREZDYWNoZSB9IGZyb20gJy4uL2NhY2hlL1BERkNhY2hlJztcclxuXHJcbmV4cG9ydCBjbGFzcyBQREZWaWV3ZXJCYXNlIGV4dGVuZHMgQXBwbGljYXRpb24ge1xyXG4gICAgcHJvdGVjdGVkIF9mcmFtZTogSFRNTElGcmFtZUVsZW1lbnQ7XHJcblxyXG4gICAgcHVibGljIGdldCBhcHAoKSB7XHJcbiAgICAgICAgLy8gQHRzLWlnbm9yZVxyXG4gICAgICAgIHJldHVybiB0aGlzLl9mcmFtZS5jb250ZW50V2luZG93LlBERlZpZXdlckFwcGxpY2F0aW9uO1xyXG4gICAgfVxyXG5cclxuICAgIHN0YXRpYyBnZXQgZGVmYXVsdE9wdGlvbnMoKSB7XHJcbiAgICAgICAgY29uc3Qgb3B0aW9ucyA9IHN1cGVyLmRlZmF1bHRPcHRpb25zO1xyXG4gICAgICAgIG9wdGlvbnMuaWQgPSAncGRmLXZpZXdlcic7XHJcbiAgICAgICAgb3B0aW9ucy5jbGFzc2VzID0gWydhcHAnLCAnd2luZG93LWFwcCddO1xyXG4gICAgICAgIG9wdGlvbnMudGl0bGUgPSAnVmlldyBQREYnO1xyXG4gICAgICAgIG9wdGlvbnMud2lkdGggPSA4LjUgKiAxMDAgKyA2NDtcclxuICAgICAgICBvcHRpb25zLmhlaWdodCA9IDExICogMTAwICsgNjQ7XHJcbiAgICAgICAgb3B0aW9ucy5yZXNpemFibGUgPSB0cnVlO1xyXG4gICAgICAgIHJldHVybiBvcHRpb25zO1xyXG4gICAgfVxyXG5cclxuICAgIHByb3RlY3RlZCBhc3luYyBhY3RpdmF0ZUxpc3RlbmVycyhodG1sOiBKUXVlcnk8SFRNTEVsZW1lbnQ+KTogUHJvbWlzZTx2b2lkPiB7XHJcbiAgICAgICAgc3VwZXIuYWN0aXZhdGVMaXN0ZW5lcnMoaHRtbCk7XHJcblxyXG4gICAgICAgIHRoaXMuX2ZyYW1lID0gaHRtbC5wYXJlbnRzKCkuZmluZCgnaWZyYW1lLnBkZlZpZXdlcicpLmZpcnN0KCkuZ2V0KDApIGFzIEhUTUxJRnJhbWVFbGVtZW50O1xyXG5cclxuICAgICAgICAvLyBAdHMtaWdub3JlXHJcbiAgICAgICAgd2luZG93LnZpZXdlciA9IHRoaXM7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBBdHRlbXB0IHRvIHNhZmVseSBjbGVhbnVwIFBERmpzIHRvIGF2b2lkIG1lbW9yeSBsZWFrcy5cclxuICAgICAqL1xyXG4gICAgcHJvdGVjdGVkIGNsZWFudXAoKTogdm9pZCB7XHJcbiAgICAgICAgaWYgKHRoaXMuX2ZyYW1lICYmIHRoaXMuX2ZyYW1lLmNvbnRlbnRXaW5kb3cpIHtcclxuICAgICAgICAgICAgY29uc3Qgd2luZG93ID0gdGhpcy5fZnJhbWUuY29udGVudFdpbmRvdztcclxuICAgICAgICAgICAgLy8gQHRzLWlnbm9yZVxyXG4gICAgICAgICAgICB3aW5kb3cuUERGVmlld2VyQXBwbGljYXRpb24uY2xlYW51cCgpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBjbG9zZSgpOiBQcm9taXNlPGFueT4ge1xyXG4gICAgICAgIHRoaXMuY2xlYW51cCgpO1xyXG4gICAgICAgIHJldHVybiBzdXBlci5jbG9zZSgpO1xyXG4gICAgfVxyXG59XHJcbiIsIi8qIENvcHlyaWdodCAyMDIwIEFuZHJldyBDdWNjaW5lbGxvXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuXHJcbmltcG9ydCB7IFBERlZpZXdlckJhc2UgfSBmcm9tICcuL1BERlZpZXdlckJhc2UnO1xyXG5pbXBvcnQgeyBQREZTZXR0aW5ncyB9IGZyb20gJy4uL3NldHRpbmdzL1BERlNldHRpbmdzJztcclxuXHJcbmV4cG9ydCBjbGFzcyBQREZWaWV3ZXJXZWIgZXh0ZW5kcyBQREZWaWV3ZXJCYXNlIHtcclxuICAgIHByaXZhdGUgbV9QYWdlOiBudW1iZXI7XHJcbiAgICBwcml2YXRlIG1fRmlsZVBhdGg6IHN0cmluZztcclxuXHJcbiAgICBzdGF0aWMgZ2V0IGRlZmF1bHRPcHRpb25zKCkge1xyXG4gICAgICAgIGNvbnN0IG9wdGlvbnMgPSBzdXBlci5kZWZhdWx0T3B0aW9ucztcclxuICAgICAgICBvcHRpb25zLnRlbXBsYXRlID0gYHN5c3RlbXMvJHtQREZTZXR0aW5ncy5FWFRFUk5BTF9TWVNURU1fTkFNRX0vcGRmb3VuZHJ5LWRpc3QvdGVtcGxhdGVzL3dlYi12aWV3ZXItYXBwLmh0bWxgO1xyXG4gICAgICAgIHJldHVybiBvcHRpb25zO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0cnVjdG9yKGZpbGU6IHN0cmluZywgcGFnZTogbnVtYmVyKSB7XHJcbiAgICAgICAgc3VwZXIoKTtcclxuXHJcbiAgICAgICAgdGhpcy5tX0ZpbGVQYXRoID0gZW5jb2RlVVJJQ29tcG9uZW50KGZpbGUpO1xyXG4gICAgICAgIHRoaXMubV9QYWdlID0gcGFnZTtcclxuICAgIH1cclxuXHJcbiAgICBnZXREYXRhKG9wdGlvbnM/OiBhbnkpOiBhbnkgfCBQcm9taXNlPGFueT4ge1xyXG4gICAgICAgIGNvbnN0IGRhdGEgPSBzdXBlci5nZXREYXRhKG9wdGlvbnMpO1xyXG4gICAgICAgIGRhdGEucGFnZSA9IHRoaXMubV9QYWdlO1xyXG4gICAgICAgIGRhdGEuZmlsZVBhdGggPSB0aGlzLm1fRmlsZVBhdGg7XHJcbiAgICAgICAgZGF0YS5zeXN0ZW1OYW1lID0gUERGU2V0dGluZ3MuRVhURVJOQUxfU1lTVEVNX05BTUU7XHJcbiAgICAgICAgcmV0dXJuIGRhdGE7XHJcbiAgICB9XHJcbn1cclxuIl19"}