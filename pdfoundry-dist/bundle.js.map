{"version":3,"sources":["node_modules/browser-pack/_prelude.js","module/api/PDFoundryAPI.ts","module/app/PDFItemSheet.ts","module/main.ts","module/settings/PDFSettings.ts","module/viewer/PDFViewerBase.ts","module/viewer/PDFViewerWeb.ts"],"names":[],"mappings":"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","file":"bundle.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()","/* Copyright 2020 Andrew Cuccinello\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *     http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\nimport { PDFSettings } from '../settings/PDFSettings';\r\nimport { PDFViewerWeb } from '../viewer/PDFViewerWeb';\r\n\r\nexport class PDFoundryAPIError extends Error {\r\n    constructor(message?: string) {\r\n        super(message);\r\n    }\r\n}\r\n\r\n/**\r\n * All the properties of a PDF that can be specified by a user\r\n */\r\nexport type PDFData = {\r\n    code: string;\r\n    url: string;\r\n    offset: number;\r\n    cache: boolean;\r\n};\r\n\r\nexport class PDFoundryAPI {\r\n    /**\r\n     * Register your system with the API.\r\n     * @param system The module YOU are calling this from.\r\n     */\r\n    public static async registerSystem(system: string) {\r\n        PDFSettings.EXTERNAL_SYSTEM_NAME = system;\r\n    }\r\n\r\n    /**\r\n     * Get an object containing the user specified PDF data for a specific PDF code.\r\n     * @param code\r\n     */\r\n    public static getPDFData(code: string): null | PDFData {\r\n        const entity = game.items.find((item) => {\r\n            return item.data.type === PDFSettings.PDF_ENTITY_TYPE && item.data.data.code === code;\r\n        });\r\n        if (entity === undefined || entity === null) {\r\n            return null;\r\n        }\r\n\r\n        const data = entity.data.data;\r\n        if (data.offset === '') {\r\n            data.offset = 0;\r\n        }\r\n        data.offset = parseInt(data.offset);\r\n        return data;\r\n    }\r\n\r\n    /**\r\n     * Open a PDF by code to the specified page.\r\n     * @param code\r\n     * @param page\r\n     */\r\n    public static open(code: string, page: number = 1) {\r\n        const pdf = this.getPDFData(code);\r\n        if (pdf === null) {\r\n            throw new PDFoundryAPIError(`Unable to find a PDF with the code \"${code}. Did the user declare it?`);\r\n        }\r\n\r\n        const { url, offset } = pdf;\r\n        // coerce to number; safety first\r\n        page = offset + parseInt(page.toString());\r\n\r\n        this.openURL(`${window.origin}/${url}`, page);\r\n    }\r\n\r\n    /**\r\n     * Open a PDF by URL to the specified page.\r\n     * @param url\r\n     * @param page\r\n     */\r\n    public static openURL(url: string, page: number = 1) {\r\n        if (url === undefined) {\r\n            throw new PDFoundryAPIError('Unable to open PDF; \"url\" must be defined');\r\n        }\r\n\r\n        // coerce to number; safety first\r\n        page = parseInt(page.toString());\r\n        if (isNaN(page) || page <= 0) {\r\n            throw new PDFoundryAPIError(`Page must be > 0 but ${page} was given.`);\r\n        }\r\n\r\n        new PDFViewerWeb(url, page).render(true);\r\n    }\r\n}\r\n","/* Copyright 2020 Andrew Cuccinello\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *     http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\nimport { PDFSettings } from '../settings/PDFSettings';\r\nimport { PDFoundryAPI } from '../api/PDFoundryAPI';\r\n/**\r\n * Extends the base ItemSheet for linked PDF viewing.\r\n */\r\nexport class PDFSourceSheet extends ItemSheet {\r\n    static get defaultOptions() {\r\n        const options = super.defaultOptions;\r\n        options.classes = ['sheet', 'item'];\r\n        options.width = 650;\r\n        options.height = 'auto';\r\n        return options;\r\n    }\r\n\r\n    get template() {\r\n        return `systems/${PDFSettings.EXTERNAL_SYSTEM_NAME}/${PDFSettings.DIST_FOLDER}/templates/pdf-sheet.html`;\r\n    }\r\n\r\n    /**\r\n     * Helper method to get a id in the html form\r\n     * html ids are prepended with the id of the item to preserve uniqueness\r\n     *  which is mandatory to allow multiple forms to be open\r\n     * @param html\r\n     * @param id\r\n     */\r\n    private getByID(html: JQuery<HTMLElement>, id: string) {\r\n        return html.parent().parent().find(`#${this.item._id}-${id}`);\r\n    }\r\n\r\n    protected activateListeners(html: JQuery<HTMLElement>): void {\r\n        super.activateListeners(html);\r\n\r\n        this.addGithubLink(html);\r\n\r\n        const urlInput = this.getByID(html, 'data\\\\.url');\r\n        const offsetInput = this.getByID(html, 'data\\\\.offset');\r\n\r\n        // Block enter from displaying the PDF\r\n        html.find('input').on('keypress', function (event) {\r\n            if (event.key === 'Enter') {\r\n                event.preventDefault();\r\n            }\r\n        });\r\n\r\n        console.log(this.getByID(html, 'pdf-test'));\r\n\r\n        // Test button\r\n        this.getByID(html, 'pdf-test').on('click', function (event) {\r\n            event.preventDefault();\r\n\r\n            let urlValue = urlInput.val();\r\n            let offsetValue = offsetInput.val();\r\n\r\n            if (urlValue === null || urlValue === undefined) return;\r\n            if (offsetValue === null || offsetValue === undefined) return;\r\n\r\n            urlValue = `${window.location.origin}/${urlValue}`;\r\n\r\n            if (offsetValue.toString().trim() === '') {\r\n                offsetValue = 0;\r\n            }\r\n            offsetValue = parseInt(offsetValue as string);\r\n\r\n            PDFoundryAPI.openURL(urlValue, 5 + offsetValue);\r\n        });\r\n\r\n        // Browse button\r\n        this.getByID(html, 'pdf-browse').on('click', async function (event) {\r\n            event.preventDefault();\r\n\r\n            const fp = new FilePicker({});\r\n            // @ts-ignore TODO: foundry-pc-types\r\n            fp.extensions = ['.pdf'];\r\n            fp.field = urlInput[0];\r\n\r\n            let urlValue = urlInput.val();\r\n            if (urlValue !== undefined) {\r\n                const result = await fp.browse(urlValue.toString().trim());\r\n            }\r\n\r\n            fp.render(true);\r\n        });\r\n    }\r\n\r\n    protected addGithubLink(html: JQuery<HTMLElement>) {\r\n        const h4 = html.parent().parent().find('header.window-header h4.window-title');\r\n        const next = h4.next()[0].childNodes[1].textContent;\r\n        if (next && next.trim() === 'PDFoundry') {\r\n            return;\r\n        }\r\n\r\n        const url = 'https://github.com/Djphoenix719/PDFoundry';\r\n        const style = 'text-decoration: none';\r\n        const icon = '<i class=\"fas fa-external-link-alt\"></i>';\r\n        const link = $(`<a style=\"${style}\" href=\"${url}\">${icon} PDFoundry</a>`);\r\n\r\n        h4.after(link);\r\n    }\r\n}\r\n","/* Copyright 2020 Andrew Cuccinello\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *     http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\nimport { PDFoundryAPI } from './api/PDFoundryAPI';\r\nimport { PDFSettings } from './settings/PDFSettings';\r\nCONFIG.debug.hooks = true;\r\n\r\n// Register UI accessor\r\nHooks.on('init', function () {\r\n    // @ts-ignore\r\n    ui.PDFoundry = PDFoundryAPI;\r\n});\r\nHooks.once('ready', PDFSettings.registerPDFSheet);\r\nHooks.on('preCreateItem', PDFSettings.preCreateItem);\r\nHooks.on('getItemDirectoryEntryContext', PDFSettings.getItemContextOptions);\r\n","/* Copyright 2020 Andrew Cuccinello\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *     http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\nimport { PDFSourceSheet } from '../app/PDFItemSheet';\r\nimport { PDFoundryAPI } from '../api/PDFoundryAPI';\r\n\r\n/**\r\n * Internal settings and helper methods for PDFoundry.\r\n */\r\nexport class PDFSettings {\r\n    public static DIST_FOLDER: string = 'pdfoundry-dist';\r\n    public static EXTERNAL_SYSTEM_NAME: string = '../modules/pdfoundry';\r\n    public static INTERNAL_MODULE_NAME: string = 'PDFoundry';\r\n    public static PDF_ENTITY_TYPE: string = 'PDFoundry_PDF';\r\n\r\n    /**\r\n     * Register the PDF sheet and unregister invalid sheet types from it.\r\n     */\r\n    public static registerPDFSheet() {\r\n        //  static unregisterSheet(scope, sheetClass, {types=[]}={}) {\r\n        Items.unregisterSheet(PDFSettings.INTERNAL_MODULE_NAME, 'SR5ItemSheet', {\r\n            types: [PDFSettings.PDF_ENTITY_TYPE],\r\n        });\r\n        Items.registerSheet(PDFSettings.INTERNAL_MODULE_NAME, PDFSourceSheet, {\r\n            types: [PDFSettings.PDF_ENTITY_TYPE],\r\n            makeDefault: true,\r\n        });\r\n\r\n        // Unregister all other item sheets for the PDF entity\r\n        const pdfoundryKey = `${PDFSettings.INTERNAL_MODULE_NAME}.${PDFSourceSheet.name}`;\r\n        const sheets = CONFIG.Item.sheetClasses[PDFSettings.PDF_ENTITY_TYPE];\r\n        for (const key of Object.keys(sheets)) {\r\n            const sheet = sheets[key];\r\n            // keep the PDFoundry sheet\r\n            if (sheet.id === pdfoundryKey) {\r\n                continue;\r\n            }\r\n\r\n            // id is MODULE.CLASS_NAME\r\n            const [module] = sheet.id.split('.');\r\n            Items.unregisterSheet(module, sheet.cls, {\r\n                types: [PDFSettings.PDF_ENTITY_TYPE],\r\n            });\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Setup default values for pdf entities\r\n     * @param entity\r\n     * @param args ignored args\r\n     */\r\n    public static async preCreateItem(entity, ...args) {\r\n        if (entity.type !== PDFSettings.PDF_ENTITY_TYPE) {\r\n            return;\r\n        }\r\n        entity.img = `systems/${PDFSettings.EXTERNAL_SYSTEM_NAME}/${PDFSettings.DIST_FOLDER}/assets/pdf_icon.svg`;\r\n    }\r\n\r\n    /**\r\n     * Helper method to grab the id from the html object and return an item\r\n     * @param html\r\n     */\r\n    private static getItemFromContext(html: JQuery<HTMLElement>): Item {\r\n        const id = html.data('entity-id');\r\n        return game.items.get(id);\r\n    }\r\n\r\n    /**\r\n     * Get additional context menu icons for PDF items\r\n     * @param html\r\n     * @param options\r\n     */\r\n    public static getItemContextOptions(html, options: any[]) {\r\n        options.splice(0, 0, {\r\n            name: 'Open PDF',\r\n            icon: '<i class=\"far fa-file-pdf\"></i>',\r\n            condition: (entityHtml: JQuery<HTMLElement>) => {\r\n                const item = PDFSettings.getItemFromContext(entityHtml);\r\n                if (item.type !== PDFSettings.PDF_ENTITY_TYPE) {\r\n                    return false;\r\n                }\r\n\r\n                const { code, url } = item.data.data;\r\n                return code !== '' && url !== '';\r\n            },\r\n            callback: (entityHtml: JQuery<HTMLElement>) => {\r\n                const item = PDFSettings.getItemFromContext(entityHtml);\r\n                const { code } = item.data.data;\r\n                PDFoundryAPI.open(code);\r\n            },\r\n        });\r\n    }\r\n}\r\n","/* Copyright 2020 Andrew Cuccinello\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *     http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\nexport class PDFViewerBase extends Application {\r\n    protected m_Frame: HTMLIFrameElement;\r\n\r\n    static get defaultOptions() {\r\n        const options = super.defaultOptions;\r\n        options.id = 'pdf-viewer';\r\n        options.classes = ['app', 'window-app'];\r\n        options.title = 'View PDF';\r\n        options.width = 8.5 * 100 + 64;\r\n        options.height = 11 * 100 + 64;\r\n        options.resizable = true;\r\n        return options;\r\n    }\r\n\r\n    protected async activateListeners(html: JQuery<HTMLElement>): Promise<void> {\r\n        super.activateListeners(html);\r\n\r\n        this.m_Frame = html.parents().find('iframe.pdfViewer').first().get(0) as HTMLIFrameElement;\r\n    }\r\n\r\n    close(): Promise<any> {\r\n        // @ts-ignore\r\n        const pva = this.m_Frame.contentWindow.PDFViewerApplication;\r\n        console.log(pva);\r\n\r\n        pva.cleanup();\r\n        return super.close();\r\n    }\r\n}\r\n","/* Copyright 2020 Andrew Cuccinello\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *     http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\nimport { PDFViewerBase } from './PDFViewerBase';\r\nimport { PDFSettings } from '../settings/PDFSettings';\r\n\r\nexport class PDFViewerWeb extends PDFViewerBase {\r\n    private m_Page: number;\r\n    private m_FilePath: string;\r\n\r\n    static get defaultOptions() {\r\n        const options = super.defaultOptions;\r\n        options.template = `systems/${PDFSettings.EXTERNAL_SYSTEM_NAME}/pdfoundry-dist/templates/web-viewer-app.html`;\r\n        return options;\r\n    }\r\n\r\n    constructor(file: string, page: number) {\r\n        super();\r\n\r\n        this.m_FilePath = encodeURIComponent(file);\r\n        this.m_Page = page;\r\n    }\r\n\r\n    getData(options?: any): any | Promise<any> {\r\n        const data = super.getData(options);\r\n        data.page = this.m_Page;\r\n        data.filePath = this.m_FilePath;\r\n        data.systemName = PDFSettings.EXTERNAL_SYSTEM_NAME;\r\n        return data;\r\n    }\r\n}\r\n"],"preExistingComment":"//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJtb2R1bGUvYXBpL1BERm91bmRyeUFQSS50cyIsIm1vZHVsZS9hcHAvUERGSXRlbVNoZWV0LnRzIiwibW9kdWxlL21haW4udHMiLCJtb2R1bGUvc2V0dGluZ3MvUERGU2V0dGluZ3MudHMiLCJtb2R1bGUvdmlld2VyL1BERlZpZXdlckJhc2UudHMiLCJtb2R1bGUvdmlld2VyL1BERlZpZXdlcldlYi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7QUNBQTs7Ozs7Ozs7Ozs7OztHQWFHOzs7Ozs7Ozs7Ozs7QUFFSCx5REFBc0Q7QUFDdEQseURBQXNEO0FBRXRELE1BQWEsaUJBQWtCLFNBQVEsS0FBSztJQUN4QyxZQUFZLE9BQWdCO1FBQ3hCLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUNuQixDQUFDO0NBQ0o7QUFKRCw4Q0FJQztBQVlELE1BQWEsWUFBWTtJQUNyQjs7O09BR0c7SUFDSSxNQUFNLENBQU8sY0FBYyxDQUFDLE1BQWM7O1lBQzdDLHlCQUFXLENBQUMsb0JBQW9CLEdBQUcsTUFBTSxDQUFDO1FBQzlDLENBQUM7S0FBQTtJQUVEOzs7T0FHRztJQUNJLE1BQU0sQ0FBQyxVQUFVLENBQUMsSUFBWTtRQUNqQyxNQUFNLE1BQU0sR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDLElBQUksRUFBRSxFQUFFO1lBQ3BDLE9BQU8sSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLEtBQUsseUJBQVcsQ0FBQyxlQUFlLElBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxLQUFLLElBQUksQ0FBQztRQUMxRixDQUFDLENBQUMsQ0FBQztRQUNILElBQUksTUFBTSxLQUFLLFNBQVMsSUFBSSxNQUFNLEtBQUssSUFBSSxFQUFFO1lBQ3pDLE9BQU8sSUFBSSxDQUFDO1NBQ2Y7UUFFRCxNQUFNLElBQUksR0FBRyxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQztRQUM5QixJQUFJLElBQUksQ0FBQyxNQUFNLEtBQUssRUFBRSxFQUFFO1lBQ3BCLElBQUksQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDO1NBQ25CO1FBQ0QsSUFBSSxDQUFDLE1BQU0sR0FBRyxRQUFRLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQ3BDLE9BQU8sSUFBSSxDQUFDO0lBQ2hCLENBQUM7SUFFRDs7OztPQUlHO0lBQ0ksTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFZLEVBQUUsT0FBZSxDQUFDO1FBQzdDLE1BQU0sR0FBRyxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDbEMsSUFBSSxHQUFHLEtBQUssSUFBSSxFQUFFO1lBQ2QsTUFBTSxJQUFJLGlCQUFpQixDQUFDLHVDQUF1QyxJQUFJLDRCQUE0QixDQUFDLENBQUM7U0FDeEc7UUFFRCxNQUFNLEVBQUUsR0FBRyxFQUFFLE1BQU0sRUFBRSxHQUFHLEdBQUcsQ0FBQztRQUM1QixpQ0FBaUM7UUFDakMsSUFBSSxHQUFHLE1BQU0sR0FBRyxRQUFRLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFDLENBQUM7UUFFMUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxHQUFHLE1BQU0sQ0FBQyxNQUFNLElBQUksR0FBRyxFQUFFLEVBQUUsSUFBSSxDQUFDLENBQUM7SUFDbEQsQ0FBQztJQUVEOzs7O09BSUc7SUFDSSxNQUFNLENBQUMsT0FBTyxDQUFDLEdBQVcsRUFBRSxPQUFlLENBQUM7UUFDL0MsSUFBSSxHQUFHLEtBQUssU0FBUyxFQUFFO1lBQ25CLE1BQU0sSUFBSSxpQkFBaUIsQ0FBQywyQ0FBMkMsQ0FBQyxDQUFDO1NBQzVFO1FBRUQsaUNBQWlDO1FBQ2pDLElBQUksR0FBRyxRQUFRLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFDLENBQUM7UUFDakMsSUFBSSxLQUFLLENBQUMsSUFBSSxDQUFDLElBQUksSUFBSSxJQUFJLENBQUMsRUFBRTtZQUMxQixNQUFNLElBQUksaUJBQWlCLENBQUMsd0JBQXdCLElBQUksYUFBYSxDQUFDLENBQUM7U0FDMUU7UUFFRCxJQUFJLDJCQUFZLENBQUMsR0FBRyxFQUFFLElBQUksQ0FBQyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUM3QyxDQUFDO0NBQ0o7QUFqRUQsb0NBaUVDOzs7QUNuR0Q7Ozs7Ozs7Ozs7Ozs7R0FhRzs7Ozs7Ozs7Ozs7O0FBRUgseURBQXNEO0FBQ3RELHNEQUFtRDtBQUNuRDs7R0FFRztBQUNILE1BQWEsY0FBZSxTQUFRLFNBQVM7SUFDekMsTUFBTSxLQUFLLGNBQWM7UUFDckIsTUFBTSxPQUFPLEdBQUcsS0FBSyxDQUFDLGNBQWMsQ0FBQztRQUNyQyxPQUFPLENBQUMsT0FBTyxHQUFHLENBQUMsT0FBTyxFQUFFLE1BQU0sQ0FBQyxDQUFDO1FBQ3BDLE9BQU8sQ0FBQyxLQUFLLEdBQUcsR0FBRyxDQUFDO1FBQ3BCLE9BQU8sQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFDO1FBQ3hCLE9BQU8sT0FBTyxDQUFDO0lBQ25CLENBQUM7SUFFRCxJQUFJLFFBQVE7UUFDUixPQUFPLFdBQVcseUJBQVcsQ0FBQyxvQkFBb0IsSUFBSSx5QkFBVyxDQUFDLFdBQVcsMkJBQTJCLENBQUM7SUFDN0csQ0FBQztJQUVEOzs7Ozs7T0FNRztJQUNLLE9BQU8sQ0FBQyxJQUF5QixFQUFFLEVBQVU7UUFDakQsT0FBTyxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUMsTUFBTSxFQUFFLENBQUMsSUFBSSxDQUFDLElBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLElBQUksRUFBRSxFQUFFLENBQUMsQ0FBQztJQUNsRSxDQUFDO0lBRVMsaUJBQWlCLENBQUMsSUFBeUI7UUFDakQsS0FBSyxDQUFDLGlCQUFpQixDQUFDLElBQUksQ0FBQyxDQUFDO1FBRTlCLElBQUksQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLENBQUM7UUFFekIsTUFBTSxRQUFRLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLEVBQUUsWUFBWSxDQUFDLENBQUM7UUFDbEQsTUFBTSxXQUFXLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLEVBQUUsZUFBZSxDQUFDLENBQUM7UUFFeEQsc0NBQXNDO1FBQ3RDLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsRUFBRSxDQUFDLFVBQVUsRUFBRSxVQUFVLEtBQUs7WUFDN0MsSUFBSSxLQUFLLENBQUMsR0FBRyxLQUFLLE9BQU8sRUFBRTtnQkFDdkIsS0FBSyxDQUFDLGNBQWMsRUFBRSxDQUFDO2FBQzFCO1FBQ0wsQ0FBQyxDQUFDLENBQUM7UUFFSCxPQUFPLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxFQUFFLFVBQVUsQ0FBQyxDQUFDLENBQUM7UUFFNUMsY0FBYztRQUNkLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxFQUFFLFVBQVUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxPQUFPLEVBQUUsVUFBVSxLQUFLO1lBQ3RELEtBQUssQ0FBQyxjQUFjLEVBQUUsQ0FBQztZQUV2QixJQUFJLFFBQVEsR0FBRyxRQUFRLENBQUMsR0FBRyxFQUFFLENBQUM7WUFDOUIsSUFBSSxXQUFXLEdBQUcsV0FBVyxDQUFDLEdBQUcsRUFBRSxDQUFDO1lBRXBDLElBQUksUUFBUSxLQUFLLElBQUksSUFBSSxRQUFRLEtBQUssU0FBUztnQkFBRSxPQUFPO1lBQ3hELElBQUksV0FBVyxLQUFLLElBQUksSUFBSSxXQUFXLEtBQUssU0FBUztnQkFBRSxPQUFPO1lBRTlELFFBQVEsR0FBRyxHQUFHLE1BQU0sQ0FBQyxRQUFRLENBQUMsTUFBTSxJQUFJLFFBQVEsRUFBRSxDQUFDO1lBRW5ELElBQUksV0FBVyxDQUFDLFFBQVEsRUFBRSxDQUFDLElBQUksRUFBRSxLQUFLLEVBQUUsRUFBRTtnQkFDdEMsV0FBVyxHQUFHLENBQUMsQ0FBQzthQUNuQjtZQUNELFdBQVcsR0FBRyxRQUFRLENBQUMsV0FBcUIsQ0FBQyxDQUFDO1lBRTlDLDJCQUFZLENBQUMsT0FBTyxDQUFDLFFBQVEsRUFBRSxDQUFDLEdBQUcsV0FBVyxDQUFDLENBQUM7UUFDcEQsQ0FBQyxDQUFDLENBQUM7UUFFSCxnQkFBZ0I7UUFDaEIsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLEVBQUUsWUFBWSxDQUFDLENBQUMsRUFBRSxDQUFDLE9BQU8sRUFBRSxVQUFnQixLQUFLOztnQkFDOUQsS0FBSyxDQUFDLGNBQWMsRUFBRSxDQUFDO2dCQUV2QixNQUFNLEVBQUUsR0FBRyxJQUFJLFVBQVUsQ0FBQyxFQUFFLENBQUMsQ0FBQztnQkFDOUIsb0NBQW9DO2dCQUNwQyxFQUFFLENBQUMsVUFBVSxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUM7Z0JBQ3pCLEVBQUUsQ0FBQyxLQUFLLEdBQUcsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUV2QixJQUFJLFFBQVEsR0FBRyxRQUFRLENBQUMsR0FBRyxFQUFFLENBQUM7Z0JBQzlCLElBQUksUUFBUSxLQUFLLFNBQVMsRUFBRTtvQkFDeEIsTUFBTSxNQUFNLEdBQUcsTUFBTSxFQUFFLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxRQUFRLEVBQUUsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDO2lCQUM5RDtnQkFFRCxFQUFFLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQ3BCLENBQUM7U0FBQSxDQUFDLENBQUM7SUFDUCxDQUFDO0lBRVMsYUFBYSxDQUFDLElBQXlCO1FBQzdDLE1BQU0sRUFBRSxHQUFHLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxJQUFJLENBQUMsc0NBQXNDLENBQUMsQ0FBQztRQUMvRSxNQUFNLElBQUksR0FBRyxFQUFFLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDLFdBQVcsQ0FBQztRQUNwRCxJQUFJLElBQUksSUFBSSxJQUFJLENBQUMsSUFBSSxFQUFFLEtBQUssV0FBVyxFQUFFO1lBQ3JDLE9BQU87U0FDVjtRQUVELE1BQU0sR0FBRyxHQUFHLDJDQUEyQyxDQUFDO1FBQ3hELE1BQU0sS0FBSyxHQUFHLHVCQUF1QixDQUFDO1FBQ3RDLE1BQU0sSUFBSSxHQUFHLDBDQUEwQyxDQUFDO1FBQ3hELE1BQU0sSUFBSSxHQUFHLENBQUMsQ0FBQyxhQUFhLEtBQUssV0FBVyxHQUFHLEtBQUssSUFBSSxnQkFBZ0IsQ0FBQyxDQUFDO1FBRTFFLEVBQUUsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDbkIsQ0FBQztDQUNKO0FBN0ZELHdDQTZGQzs7O0FDakhEOzs7Ozs7Ozs7Ozs7O0dBYUc7O0FBRUgscURBQWtEO0FBQ2xELHdEQUFxRDtBQUNyRCxNQUFNLENBQUMsS0FBSyxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUM7QUFFMUIsdUJBQXVCO0FBQ3ZCLEtBQUssQ0FBQyxFQUFFLENBQUMsTUFBTSxFQUFFO0lBQ2IsYUFBYTtJQUNiLEVBQUUsQ0FBQyxTQUFTLEdBQUcsMkJBQVksQ0FBQztBQUNoQyxDQUFDLENBQUMsQ0FBQztBQUNILEtBQUssQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFLHlCQUFXLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztBQUNsRCxLQUFLLENBQUMsRUFBRSxDQUFDLGVBQWUsRUFBRSx5QkFBVyxDQUFDLGFBQWEsQ0FBQyxDQUFDO0FBQ3JELEtBQUssQ0FBQyxFQUFFLENBQUMsOEJBQThCLEVBQUUseUJBQVcsQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDOzs7QUMxQjVFOzs7Ozs7Ozs7Ozs7O0dBYUc7Ozs7Ozs7Ozs7OztBQUVILHNEQUFxRDtBQUNyRCxzREFBbUQ7QUFFbkQ7O0dBRUc7QUFDSCxNQUFhLFdBQVc7SUFNcEI7O09BRUc7SUFDSSxNQUFNLENBQUMsZ0JBQWdCO1FBQzFCLDhEQUE4RDtRQUM5RCxLQUFLLENBQUMsZUFBZSxDQUFDLFdBQVcsQ0FBQyxvQkFBb0IsRUFBRSxjQUFjLEVBQUU7WUFDcEUsS0FBSyxFQUFFLENBQUMsV0FBVyxDQUFDLGVBQWUsQ0FBQztTQUN2QyxDQUFDLENBQUM7UUFDSCxLQUFLLENBQUMsYUFBYSxDQUFDLFdBQVcsQ0FBQyxvQkFBb0IsRUFBRSw2QkFBYyxFQUFFO1lBQ2xFLEtBQUssRUFBRSxDQUFDLFdBQVcsQ0FBQyxlQUFlLENBQUM7WUFDcEMsV0FBVyxFQUFFLElBQUk7U0FDcEIsQ0FBQyxDQUFDO1FBRUgsc0RBQXNEO1FBQ3RELE1BQU0sWUFBWSxHQUFHLEdBQUcsV0FBVyxDQUFDLG9CQUFvQixJQUFJLDZCQUFjLENBQUMsSUFBSSxFQUFFLENBQUM7UUFDbEYsTUFBTSxNQUFNLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsV0FBVyxDQUFDLGVBQWUsQ0FBQyxDQUFDO1FBQ3JFLEtBQUssTUFBTSxHQUFHLElBQUksTUFBTSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsRUFBRTtZQUNuQyxNQUFNLEtBQUssR0FBRyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUM7WUFDMUIsMkJBQTJCO1lBQzNCLElBQUksS0FBSyxDQUFDLEVBQUUsS0FBSyxZQUFZLEVBQUU7Z0JBQzNCLFNBQVM7YUFDWjtZQUVELDBCQUEwQjtZQUMxQixNQUFNLENBQUMsTUFBTSxDQUFDLEdBQUcsS0FBSyxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7WUFDckMsS0FBSyxDQUFDLGVBQWUsQ0FBQyxNQUFNLEVBQUUsS0FBSyxDQUFDLEdBQUcsRUFBRTtnQkFDckMsS0FBSyxFQUFFLENBQUMsV0FBVyxDQUFDLGVBQWUsQ0FBQzthQUN2QyxDQUFDLENBQUM7U0FDTjtJQUNMLENBQUM7SUFFRDs7OztPQUlHO0lBQ0ksTUFBTSxDQUFPLGFBQWEsQ0FBQyxNQUFNLEVBQUUsR0FBRyxJQUFJOztZQUM3QyxJQUFJLE1BQU0sQ0FBQyxJQUFJLEtBQUssV0FBVyxDQUFDLGVBQWUsRUFBRTtnQkFDN0MsT0FBTzthQUNWO1lBQ0QsTUFBTSxDQUFDLEdBQUcsR0FBRyxXQUFXLFdBQVcsQ0FBQyxvQkFBb0IsSUFBSSxXQUFXLENBQUMsV0FBVyxzQkFBc0IsQ0FBQztRQUM5RyxDQUFDO0tBQUE7SUFFRDs7O09BR0c7SUFDSyxNQUFNLENBQUMsa0JBQWtCLENBQUMsSUFBeUI7UUFDdkQsTUFBTSxFQUFFLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQztRQUNsQyxPQUFPLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxDQUFDO0lBQzlCLENBQUM7SUFFRDs7OztPQUlHO0lBQ0ksTUFBTSxDQUFDLHFCQUFxQixDQUFDLElBQUksRUFBRSxPQUFjO1FBQ3BELE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRTtZQUNqQixJQUFJLEVBQUUsVUFBVTtZQUNoQixJQUFJLEVBQUUsaUNBQWlDO1lBQ3ZDLFNBQVMsRUFBRSxDQUFDLFVBQStCLEVBQUUsRUFBRTtnQkFDM0MsTUFBTSxJQUFJLEdBQUcsV0FBVyxDQUFDLGtCQUFrQixDQUFDLFVBQVUsQ0FBQyxDQUFDO2dCQUN4RCxJQUFJLElBQUksQ0FBQyxJQUFJLEtBQUssV0FBVyxDQUFDLGVBQWUsRUFBRTtvQkFDM0MsT0FBTyxLQUFLLENBQUM7aUJBQ2hCO2dCQUVELE1BQU0sRUFBRSxJQUFJLEVBQUUsR0FBRyxFQUFFLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUM7Z0JBQ3JDLE9BQU8sSUFBSSxLQUFLLEVBQUUsSUFBSSxHQUFHLEtBQUssRUFBRSxDQUFDO1lBQ3JDLENBQUM7WUFDRCxRQUFRLEVBQUUsQ0FBQyxVQUErQixFQUFFLEVBQUU7Z0JBQzFDLE1BQU0sSUFBSSxHQUFHLFdBQVcsQ0FBQyxrQkFBa0IsQ0FBQyxVQUFVLENBQUMsQ0FBQztnQkFDeEQsTUFBTSxFQUFFLElBQUksRUFBRSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDO2dCQUNoQywyQkFBWSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUM1QixDQUFDO1NBQ0osQ0FBQyxDQUFDO0lBQ1AsQ0FBQzs7QUFsRkwsa0NBbUZDO0FBbEZpQix1QkFBVyxHQUFXLGdCQUFnQixDQUFDO0FBQ3ZDLGdDQUFvQixHQUFXLHNCQUFzQixDQUFDO0FBQ3RELGdDQUFvQixHQUFXLFdBQVcsQ0FBQztBQUMzQywyQkFBZSxHQUFXLGVBQWUsQ0FBQzs7O0FDekI1RDs7Ozs7Ozs7Ozs7OztHQWFHOzs7Ozs7Ozs7Ozs7QUFFSCxNQUFhLGFBQWMsU0FBUSxXQUFXO0lBRzFDLE1BQU0sS0FBSyxjQUFjO1FBQ3JCLE1BQU0sT0FBTyxHQUFHLEtBQUssQ0FBQyxjQUFjLENBQUM7UUFDckMsT0FBTyxDQUFDLEVBQUUsR0FBRyxZQUFZLENBQUM7UUFDMUIsT0FBTyxDQUFDLE9BQU8sR0FBRyxDQUFDLEtBQUssRUFBRSxZQUFZLENBQUMsQ0FBQztRQUN4QyxPQUFPLENBQUMsS0FBSyxHQUFHLFVBQVUsQ0FBQztRQUMzQixPQUFPLENBQUMsS0FBSyxHQUFHLEdBQUcsR0FBRyxHQUFHLEdBQUcsRUFBRSxDQUFDO1FBQy9CLE9BQU8sQ0FBQyxNQUFNLEdBQUcsRUFBRSxHQUFHLEdBQUcsR0FBRyxFQUFFLENBQUM7UUFDL0IsT0FBTyxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUM7UUFDekIsT0FBTyxPQUFPLENBQUM7SUFDbkIsQ0FBQztJQUVlLGlCQUFpQixDQUFDLElBQXlCOzs7OztZQUN2RCxPQUFNLGlCQUFpQixZQUFDLElBQUksRUFBRTtZQUU5QixJQUFJLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQyxPQUFPLEVBQUUsQ0FBQyxJQUFJLENBQUMsa0JBQWtCLENBQUMsQ0FBQyxLQUFLLEVBQUUsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFzQixDQUFDO1FBQy9GLENBQUM7S0FBQTtJQUVELEtBQUs7UUFDRCxhQUFhO1FBQ2IsTUFBTSxHQUFHLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxhQUFhLENBQUMsb0JBQW9CLENBQUM7UUFDNUQsT0FBTyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUVqQixHQUFHLENBQUMsT0FBTyxFQUFFLENBQUM7UUFDZCxPQUFPLEtBQUssQ0FBQyxLQUFLLEVBQUUsQ0FBQztJQUN6QixDQUFDO0NBQ0o7QUE1QkQsc0NBNEJDOzs7QUMzQ0Q7Ozs7Ozs7Ozs7Ozs7R0FhRzs7O0FBRUgsbURBQWdEO0FBQ2hELHlEQUFzRDtBQUV0RCxNQUFhLFlBQWEsU0FBUSw2QkFBYTtJQVUzQyxZQUFZLElBQVksRUFBRSxJQUFZO1FBQ2xDLEtBQUssRUFBRSxDQUFDO1FBRVIsSUFBSSxDQUFDLFVBQVUsR0FBRyxrQkFBa0IsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUMzQyxJQUFJLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQztJQUN2QixDQUFDO0lBWEQsTUFBTSxLQUFLLGNBQWM7UUFDckIsTUFBTSxPQUFPLEdBQUcsS0FBSyxDQUFDLGNBQWMsQ0FBQztRQUNyQyxPQUFPLENBQUMsUUFBUSxHQUFHLFdBQVcseUJBQVcsQ0FBQyxvQkFBb0IsK0NBQStDLENBQUM7UUFDOUcsT0FBTyxPQUFPLENBQUM7SUFDbkIsQ0FBQztJQVNELE9BQU8sQ0FBQyxPQUFhO1FBQ2pCLE1BQU0sSUFBSSxHQUFHLEtBQUssQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDcEMsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDO1FBQ3hCLElBQUksQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDLFVBQVUsQ0FBQztRQUNoQyxJQUFJLENBQUMsVUFBVSxHQUFHLHlCQUFXLENBQUMsb0JBQW9CLENBQUM7UUFDbkQsT0FBTyxJQUFJLENBQUM7SUFDaEIsQ0FBQztDQUNKO0FBeEJELG9DQXdCQyIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uKCl7ZnVuY3Rpb24gcihlLG4sdCl7ZnVuY3Rpb24gbyhpLGYpe2lmKCFuW2ldKXtpZighZVtpXSl7dmFyIGM9XCJmdW5jdGlvblwiPT10eXBlb2YgcmVxdWlyZSYmcmVxdWlyZTtpZighZiYmYylyZXR1cm4gYyhpLCEwKTtpZih1KXJldHVybiB1KGksITApO3ZhciBhPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIraStcIidcIik7dGhyb3cgYS5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGF9dmFyIHA9bltpXT17ZXhwb3J0czp7fX07ZVtpXVswXS5jYWxsKHAuZXhwb3J0cyxmdW5jdGlvbihyKXt2YXIgbj1lW2ldWzFdW3JdO3JldHVybiBvKG58fHIpfSxwLHAuZXhwb3J0cyxyLGUsbix0KX1yZXR1cm4gbltpXS5leHBvcnRzfWZvcih2YXIgdT1cImZ1bmN0aW9uXCI9PXR5cGVvZiByZXF1aXJlJiZyZXF1aXJlLGk9MDtpPHQubGVuZ3RoO2krKylvKHRbaV0pO3JldHVybiBvfXJldHVybiByfSkoKSIsIi8qIENvcHlyaWdodCAyMDIwIEFuZHJldyBDdWNjaW5lbGxvXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuXHJcbmltcG9ydCB7IFBERlNldHRpbmdzIH0gZnJvbSAnLi4vc2V0dGluZ3MvUERGU2V0dGluZ3MnO1xyXG5pbXBvcnQgeyBQREZWaWV3ZXJXZWIgfSBmcm9tICcuLi92aWV3ZXIvUERGVmlld2VyV2ViJztcclxuXHJcbmV4cG9ydCBjbGFzcyBQREZvdW5kcnlBUElFcnJvciBleHRlbmRzIEVycm9yIHtcclxuICAgIGNvbnN0cnVjdG9yKG1lc3NhZ2U/OiBzdHJpbmcpIHtcclxuICAgICAgICBzdXBlcihtZXNzYWdlKTtcclxuICAgIH1cclxufVxyXG5cclxuLyoqXHJcbiAqIEFsbCB0aGUgcHJvcGVydGllcyBvZiBhIFBERiB0aGF0IGNhbiBiZSBzcGVjaWZpZWQgYnkgYSB1c2VyXHJcbiAqL1xyXG5leHBvcnQgdHlwZSBQREZEYXRhID0ge1xyXG4gICAgY29kZTogc3RyaW5nO1xyXG4gICAgdXJsOiBzdHJpbmc7XHJcbiAgICBvZmZzZXQ6IG51bWJlcjtcclxuICAgIGNhY2hlOiBib29sZWFuO1xyXG59O1xyXG5cclxuZXhwb3J0IGNsYXNzIFBERm91bmRyeUFQSSB7XHJcbiAgICAvKipcclxuICAgICAqIFJlZ2lzdGVyIHlvdXIgc3lzdGVtIHdpdGggdGhlIEFQSS5cclxuICAgICAqIEBwYXJhbSBzeXN0ZW0gVGhlIG1vZHVsZSBZT1UgYXJlIGNhbGxpbmcgdGhpcyBmcm9tLlxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgc3RhdGljIGFzeW5jIHJlZ2lzdGVyU3lzdGVtKHN5c3RlbTogc3RyaW5nKSB7XHJcbiAgICAgICAgUERGU2V0dGluZ3MuRVhURVJOQUxfU1lTVEVNX05BTUUgPSBzeXN0ZW07XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBHZXQgYW4gb2JqZWN0IGNvbnRhaW5pbmcgdGhlIHVzZXIgc3BlY2lmaWVkIFBERiBkYXRhIGZvciBhIHNwZWNpZmljIFBERiBjb2RlLlxyXG4gICAgICogQHBhcmFtIGNvZGVcclxuICAgICAqL1xyXG4gICAgcHVibGljIHN0YXRpYyBnZXRQREZEYXRhKGNvZGU6IHN0cmluZyk6IG51bGwgfCBQREZEYXRhIHtcclxuICAgICAgICBjb25zdCBlbnRpdHkgPSBnYW1lLml0ZW1zLmZpbmQoKGl0ZW0pID0+IHtcclxuICAgICAgICAgICAgcmV0dXJuIGl0ZW0uZGF0YS50eXBlID09PSBQREZTZXR0aW5ncy5QREZfRU5USVRZX1RZUEUgJiYgaXRlbS5kYXRhLmRhdGEuY29kZSA9PT0gY29kZTtcclxuICAgICAgICB9KTtcclxuICAgICAgICBpZiAoZW50aXR5ID09PSB1bmRlZmluZWQgfHwgZW50aXR5ID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgZGF0YSA9IGVudGl0eS5kYXRhLmRhdGE7XHJcbiAgICAgICAgaWYgKGRhdGEub2Zmc2V0ID09PSAnJykge1xyXG4gICAgICAgICAgICBkYXRhLm9mZnNldCA9IDA7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGRhdGEub2Zmc2V0ID0gcGFyc2VJbnQoZGF0YS5vZmZzZXQpO1xyXG4gICAgICAgIHJldHVybiBkYXRhO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogT3BlbiBhIFBERiBieSBjb2RlIHRvIHRoZSBzcGVjaWZpZWQgcGFnZS5cclxuICAgICAqIEBwYXJhbSBjb2RlXHJcbiAgICAgKiBAcGFyYW0gcGFnZVxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgc3RhdGljIG9wZW4oY29kZTogc3RyaW5nLCBwYWdlOiBudW1iZXIgPSAxKSB7XHJcbiAgICAgICAgY29uc3QgcGRmID0gdGhpcy5nZXRQREZEYXRhKGNvZGUpO1xyXG4gICAgICAgIGlmIChwZGYgPT09IG51bGwpIHtcclxuICAgICAgICAgICAgdGhyb3cgbmV3IFBERm91bmRyeUFQSUVycm9yKGBVbmFibGUgdG8gZmluZCBhIFBERiB3aXRoIHRoZSBjb2RlIFwiJHtjb2RlfS4gRGlkIHRoZSB1c2VyIGRlY2xhcmUgaXQ/YCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCB7IHVybCwgb2Zmc2V0IH0gPSBwZGY7XHJcbiAgICAgICAgLy8gY29lcmNlIHRvIG51bWJlcjsgc2FmZXR5IGZpcnN0XHJcbiAgICAgICAgcGFnZSA9IG9mZnNldCArIHBhcnNlSW50KHBhZ2UudG9TdHJpbmcoKSk7XHJcblxyXG4gICAgICAgIHRoaXMub3BlblVSTChgJHt3aW5kb3cub3JpZ2lufS8ke3VybH1gLCBwYWdlKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIE9wZW4gYSBQREYgYnkgVVJMIHRvIHRoZSBzcGVjaWZpZWQgcGFnZS5cclxuICAgICAqIEBwYXJhbSB1cmxcclxuICAgICAqIEBwYXJhbSBwYWdlXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBzdGF0aWMgb3BlblVSTCh1cmw6IHN0cmluZywgcGFnZTogbnVtYmVyID0gMSkge1xyXG4gICAgICAgIGlmICh1cmwgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgUERGb3VuZHJ5QVBJRXJyb3IoJ1VuYWJsZSB0byBvcGVuIFBERjsgXCJ1cmxcIiBtdXN0IGJlIGRlZmluZWQnKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIGNvZXJjZSB0byBudW1iZXI7IHNhZmV0eSBmaXJzdFxyXG4gICAgICAgIHBhZ2UgPSBwYXJzZUludChwYWdlLnRvU3RyaW5nKCkpO1xyXG4gICAgICAgIGlmIChpc05hTihwYWdlKSB8fCBwYWdlIDw9IDApIHtcclxuICAgICAgICAgICAgdGhyb3cgbmV3IFBERm91bmRyeUFQSUVycm9yKGBQYWdlIG11c3QgYmUgPiAwIGJ1dCAke3BhZ2V9IHdhcyBnaXZlbi5gKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIG5ldyBQREZWaWV3ZXJXZWIodXJsLCBwYWdlKS5yZW5kZXIodHJ1ZSk7XHJcbiAgICB9XHJcbn1cclxuIiwiLyogQ29weXJpZ2h0IDIwMjAgQW5kcmV3IEN1Y2NpbmVsbG9cclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG5cclxuaW1wb3J0IHsgUERGU2V0dGluZ3MgfSBmcm9tICcuLi9zZXR0aW5ncy9QREZTZXR0aW5ncyc7XHJcbmltcG9ydCB7IFBERm91bmRyeUFQSSB9IGZyb20gJy4uL2FwaS9QREZvdW5kcnlBUEknO1xyXG4vKipcclxuICogRXh0ZW5kcyB0aGUgYmFzZSBJdGVtU2hlZXQgZm9yIGxpbmtlZCBQREYgdmlld2luZy5cclxuICovXHJcbmV4cG9ydCBjbGFzcyBQREZTb3VyY2VTaGVldCBleHRlbmRzIEl0ZW1TaGVldCB7XHJcbiAgICBzdGF0aWMgZ2V0IGRlZmF1bHRPcHRpb25zKCkge1xyXG4gICAgICAgIGNvbnN0IG9wdGlvbnMgPSBzdXBlci5kZWZhdWx0T3B0aW9ucztcclxuICAgICAgICBvcHRpb25zLmNsYXNzZXMgPSBbJ3NoZWV0JywgJ2l0ZW0nXTtcclxuICAgICAgICBvcHRpb25zLndpZHRoID0gNjUwO1xyXG4gICAgICAgIG9wdGlvbnMuaGVpZ2h0ID0gJ2F1dG8nO1xyXG4gICAgICAgIHJldHVybiBvcHRpb25zO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCB0ZW1wbGF0ZSgpIHtcclxuICAgICAgICByZXR1cm4gYHN5c3RlbXMvJHtQREZTZXR0aW5ncy5FWFRFUk5BTF9TWVNURU1fTkFNRX0vJHtQREZTZXR0aW5ncy5ESVNUX0ZPTERFUn0vdGVtcGxhdGVzL3BkZi1zaGVldC5odG1sYDtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEhlbHBlciBtZXRob2QgdG8gZ2V0IGEgaWQgaW4gdGhlIGh0bWwgZm9ybVxyXG4gICAgICogaHRtbCBpZHMgYXJlIHByZXBlbmRlZCB3aXRoIHRoZSBpZCBvZiB0aGUgaXRlbSB0byBwcmVzZXJ2ZSB1bmlxdWVuZXNzXHJcbiAgICAgKiAgd2hpY2ggaXMgbWFuZGF0b3J5IHRvIGFsbG93IG11bHRpcGxlIGZvcm1zIHRvIGJlIG9wZW5cclxuICAgICAqIEBwYXJhbSBodG1sXHJcbiAgICAgKiBAcGFyYW0gaWRcclxuICAgICAqL1xyXG4gICAgcHJpdmF0ZSBnZXRCeUlEKGh0bWw6IEpRdWVyeTxIVE1MRWxlbWVudD4sIGlkOiBzdHJpbmcpIHtcclxuICAgICAgICByZXR1cm4gaHRtbC5wYXJlbnQoKS5wYXJlbnQoKS5maW5kKGAjJHt0aGlzLml0ZW0uX2lkfS0ke2lkfWApO1xyXG4gICAgfVxyXG5cclxuICAgIHByb3RlY3RlZCBhY3RpdmF0ZUxpc3RlbmVycyhodG1sOiBKUXVlcnk8SFRNTEVsZW1lbnQ+KTogdm9pZCB7XHJcbiAgICAgICAgc3VwZXIuYWN0aXZhdGVMaXN0ZW5lcnMoaHRtbCk7XHJcblxyXG4gICAgICAgIHRoaXMuYWRkR2l0aHViTGluayhodG1sKTtcclxuXHJcbiAgICAgICAgY29uc3QgdXJsSW5wdXQgPSB0aGlzLmdldEJ5SUQoaHRtbCwgJ2RhdGFcXFxcLnVybCcpO1xyXG4gICAgICAgIGNvbnN0IG9mZnNldElucHV0ID0gdGhpcy5nZXRCeUlEKGh0bWwsICdkYXRhXFxcXC5vZmZzZXQnKTtcclxuXHJcbiAgICAgICAgLy8gQmxvY2sgZW50ZXIgZnJvbSBkaXNwbGF5aW5nIHRoZSBQREZcclxuICAgICAgICBodG1sLmZpbmQoJ2lucHV0Jykub24oJ2tleXByZXNzJywgZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAgICAgICAgIGlmIChldmVudC5rZXkgPT09ICdFbnRlcicpIHtcclxuICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgY29uc29sZS5sb2codGhpcy5nZXRCeUlEKGh0bWwsICdwZGYtdGVzdCcpKTtcclxuXHJcbiAgICAgICAgLy8gVGVzdCBidXR0b25cclxuICAgICAgICB0aGlzLmdldEJ5SUQoaHRtbCwgJ3BkZi10ZXN0Jykub24oJ2NsaWNrJywgZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcblxyXG4gICAgICAgICAgICBsZXQgdXJsVmFsdWUgPSB1cmxJbnB1dC52YWwoKTtcclxuICAgICAgICAgICAgbGV0IG9mZnNldFZhbHVlID0gb2Zmc2V0SW5wdXQudmFsKCk7XHJcblxyXG4gICAgICAgICAgICBpZiAodXJsVmFsdWUgPT09IG51bGwgfHwgdXJsVmFsdWUgPT09IHVuZGVmaW5lZCkgcmV0dXJuO1xyXG4gICAgICAgICAgICBpZiAob2Zmc2V0VmFsdWUgPT09IG51bGwgfHwgb2Zmc2V0VmFsdWUgPT09IHVuZGVmaW5lZCkgcmV0dXJuO1xyXG5cclxuICAgICAgICAgICAgdXJsVmFsdWUgPSBgJHt3aW5kb3cubG9jYXRpb24ub3JpZ2lufS8ke3VybFZhbHVlfWA7XHJcblxyXG4gICAgICAgICAgICBpZiAob2Zmc2V0VmFsdWUudG9TdHJpbmcoKS50cmltKCkgPT09ICcnKSB7XHJcbiAgICAgICAgICAgICAgICBvZmZzZXRWYWx1ZSA9IDA7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgb2Zmc2V0VmFsdWUgPSBwYXJzZUludChvZmZzZXRWYWx1ZSBhcyBzdHJpbmcpO1xyXG5cclxuICAgICAgICAgICAgUERGb3VuZHJ5QVBJLm9wZW5VUkwodXJsVmFsdWUsIDUgKyBvZmZzZXRWYWx1ZSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIC8vIEJyb3dzZSBidXR0b25cclxuICAgICAgICB0aGlzLmdldEJ5SUQoaHRtbCwgJ3BkZi1icm93c2UnKS5vbignY2xpY2snLCBhc3luYyBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IGZwID0gbmV3IEZpbGVQaWNrZXIoe30pO1xyXG4gICAgICAgICAgICAvLyBAdHMtaWdub3JlIFRPRE86IGZvdW5kcnktcGMtdHlwZXNcclxuICAgICAgICAgICAgZnAuZXh0ZW5zaW9ucyA9IFsnLnBkZiddO1xyXG4gICAgICAgICAgICBmcC5maWVsZCA9IHVybElucHV0WzBdO1xyXG5cclxuICAgICAgICAgICAgbGV0IHVybFZhbHVlID0gdXJsSW5wdXQudmFsKCk7XHJcbiAgICAgICAgICAgIGlmICh1cmxWYWx1ZSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBmcC5icm93c2UodXJsVmFsdWUudG9TdHJpbmcoKS50cmltKCkpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBmcC5yZW5kZXIodHJ1ZSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJvdGVjdGVkIGFkZEdpdGh1YkxpbmsoaHRtbDogSlF1ZXJ5PEhUTUxFbGVtZW50Pikge1xyXG4gICAgICAgIGNvbnN0IGg0ID0gaHRtbC5wYXJlbnQoKS5wYXJlbnQoKS5maW5kKCdoZWFkZXIud2luZG93LWhlYWRlciBoNC53aW5kb3ctdGl0bGUnKTtcclxuICAgICAgICBjb25zdCBuZXh0ID0gaDQubmV4dCgpWzBdLmNoaWxkTm9kZXNbMV0udGV4dENvbnRlbnQ7XHJcbiAgICAgICAgaWYgKG5leHQgJiYgbmV4dC50cmltKCkgPT09ICdQREZvdW5kcnknKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IHVybCA9ICdodHRwczovL2dpdGh1Yi5jb20vRGpwaG9lbml4NzE5L1BERm91bmRyeSc7XHJcbiAgICAgICAgY29uc3Qgc3R5bGUgPSAndGV4dC1kZWNvcmF0aW9uOiBub25lJztcclxuICAgICAgICBjb25zdCBpY29uID0gJzxpIGNsYXNzPVwiZmFzIGZhLWV4dGVybmFsLWxpbmstYWx0XCI+PC9pPic7XHJcbiAgICAgICAgY29uc3QgbGluayA9ICQoYDxhIHN0eWxlPVwiJHtzdHlsZX1cIiBocmVmPVwiJHt1cmx9XCI+JHtpY29ufSBQREZvdW5kcnk8L2E+YCk7XHJcblxyXG4gICAgICAgIGg0LmFmdGVyKGxpbmspO1xyXG4gICAgfVxyXG59XHJcbiIsIi8qIENvcHlyaWdodCAyMDIwIEFuZHJldyBDdWNjaW5lbGxvXHJcbiAqXHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XHJcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cclxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XHJcbiAqXHJcbiAqICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxyXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXHJcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxyXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuXHJcbmltcG9ydCB7IFBERm91bmRyeUFQSSB9IGZyb20gJy4vYXBpL1BERm91bmRyeUFQSSc7XHJcbmltcG9ydCB7IFBERlNldHRpbmdzIH0gZnJvbSAnLi9zZXR0aW5ncy9QREZTZXR0aW5ncyc7XHJcbkNPTkZJRy5kZWJ1Zy5ob29rcyA9IHRydWU7XHJcblxyXG4vLyBSZWdpc3RlciBVSSBhY2Nlc3NvclxyXG5Ib29rcy5vbignaW5pdCcsIGZ1bmN0aW9uICgpIHtcclxuICAgIC8vIEB0cy1pZ25vcmVcclxuICAgIHVpLlBERm91bmRyeSA9IFBERm91bmRyeUFQSTtcclxufSk7XHJcbkhvb2tzLm9uY2UoJ3JlYWR5JywgUERGU2V0dGluZ3MucmVnaXN0ZXJQREZTaGVldCk7XHJcbkhvb2tzLm9uKCdwcmVDcmVhdGVJdGVtJywgUERGU2V0dGluZ3MucHJlQ3JlYXRlSXRlbSk7XHJcbkhvb2tzLm9uKCdnZXRJdGVtRGlyZWN0b3J5RW50cnlDb250ZXh0JywgUERGU2V0dGluZ3MuZ2V0SXRlbUNvbnRleHRPcHRpb25zKTtcclxuIiwiLyogQ29weXJpZ2h0IDIwMjAgQW5kcmV3IEN1Y2NpbmVsbG9cclxuICpcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcclxuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxyXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcclxuICpcclxuICogICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG4gKlxyXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXHJcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcclxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXHJcbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcclxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbiAqL1xyXG5cclxuaW1wb3J0IHsgUERGU291cmNlU2hlZXQgfSBmcm9tICcuLi9hcHAvUERGSXRlbVNoZWV0JztcclxuaW1wb3J0IHsgUERGb3VuZHJ5QVBJIH0gZnJvbSAnLi4vYXBpL1BERm91bmRyeUFQSSc7XHJcblxyXG4vKipcclxuICogSW50ZXJuYWwgc2V0dGluZ3MgYW5kIGhlbHBlciBtZXRob2RzIGZvciBQREZvdW5kcnkuXHJcbiAqL1xyXG5leHBvcnQgY2xhc3MgUERGU2V0dGluZ3Mge1xyXG4gICAgcHVibGljIHN0YXRpYyBESVNUX0ZPTERFUjogc3RyaW5nID0gJ3BkZm91bmRyeS1kaXN0JztcclxuICAgIHB1YmxpYyBzdGF0aWMgRVhURVJOQUxfU1lTVEVNX05BTUU6IHN0cmluZyA9ICcuLi9tb2R1bGVzL3BkZm91bmRyeSc7XHJcbiAgICBwdWJsaWMgc3RhdGljIElOVEVSTkFMX01PRFVMRV9OQU1FOiBzdHJpbmcgPSAnUERGb3VuZHJ5JztcclxuICAgIHB1YmxpYyBzdGF0aWMgUERGX0VOVElUWV9UWVBFOiBzdHJpbmcgPSAnUERGb3VuZHJ5X1BERic7XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBSZWdpc3RlciB0aGUgUERGIHNoZWV0IGFuZCB1bnJlZ2lzdGVyIGludmFsaWQgc2hlZXQgdHlwZXMgZnJvbSBpdC5cclxuICAgICAqL1xyXG4gICAgcHVibGljIHN0YXRpYyByZWdpc3RlclBERlNoZWV0KCkge1xyXG4gICAgICAgIC8vICBzdGF0aWMgdW5yZWdpc3RlclNoZWV0KHNjb3BlLCBzaGVldENsYXNzLCB7dHlwZXM9W119PXt9KSB7XHJcbiAgICAgICAgSXRlbXMudW5yZWdpc3RlclNoZWV0KFBERlNldHRpbmdzLklOVEVSTkFMX01PRFVMRV9OQU1FLCAnU1I1SXRlbVNoZWV0Jywge1xyXG4gICAgICAgICAgICB0eXBlczogW1BERlNldHRpbmdzLlBERl9FTlRJVFlfVFlQRV0sXHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgSXRlbXMucmVnaXN0ZXJTaGVldChQREZTZXR0aW5ncy5JTlRFUk5BTF9NT0RVTEVfTkFNRSwgUERGU291cmNlU2hlZXQsIHtcclxuICAgICAgICAgICAgdHlwZXM6IFtQREZTZXR0aW5ncy5QREZfRU5USVRZX1RZUEVdLFxyXG4gICAgICAgICAgICBtYWtlRGVmYXVsdDogdHJ1ZSxcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgLy8gVW5yZWdpc3RlciBhbGwgb3RoZXIgaXRlbSBzaGVldHMgZm9yIHRoZSBQREYgZW50aXR5XHJcbiAgICAgICAgY29uc3QgcGRmb3VuZHJ5S2V5ID0gYCR7UERGU2V0dGluZ3MuSU5URVJOQUxfTU9EVUxFX05BTUV9LiR7UERGU291cmNlU2hlZXQubmFtZX1gO1xyXG4gICAgICAgIGNvbnN0IHNoZWV0cyA9IENPTkZJRy5JdGVtLnNoZWV0Q2xhc3Nlc1tQREZTZXR0aW5ncy5QREZfRU5USVRZX1RZUEVdO1xyXG4gICAgICAgIGZvciAoY29uc3Qga2V5IG9mIE9iamVjdC5rZXlzKHNoZWV0cykpIHtcclxuICAgICAgICAgICAgY29uc3Qgc2hlZXQgPSBzaGVldHNba2V5XTtcclxuICAgICAgICAgICAgLy8ga2VlcCB0aGUgUERGb3VuZHJ5IHNoZWV0XHJcbiAgICAgICAgICAgIGlmIChzaGVldC5pZCA9PT0gcGRmb3VuZHJ5S2V5KSB7XHJcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gaWQgaXMgTU9EVUxFLkNMQVNTX05BTUVcclxuICAgICAgICAgICAgY29uc3QgW21vZHVsZV0gPSBzaGVldC5pZC5zcGxpdCgnLicpO1xyXG4gICAgICAgICAgICBJdGVtcy51bnJlZ2lzdGVyU2hlZXQobW9kdWxlLCBzaGVldC5jbHMsIHtcclxuICAgICAgICAgICAgICAgIHR5cGVzOiBbUERGU2V0dGluZ3MuUERGX0VOVElUWV9UWVBFXSxcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogU2V0dXAgZGVmYXVsdCB2YWx1ZXMgZm9yIHBkZiBlbnRpdGllc1xyXG4gICAgICogQHBhcmFtIGVudGl0eVxyXG4gICAgICogQHBhcmFtIGFyZ3MgaWdub3JlZCBhcmdzXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBzdGF0aWMgYXN5bmMgcHJlQ3JlYXRlSXRlbShlbnRpdHksIC4uLmFyZ3MpIHtcclxuICAgICAgICBpZiAoZW50aXR5LnR5cGUgIT09IFBERlNldHRpbmdzLlBERl9FTlRJVFlfVFlQRSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVudGl0eS5pbWcgPSBgc3lzdGVtcy8ke1BERlNldHRpbmdzLkVYVEVSTkFMX1NZU1RFTV9OQU1FfS8ke1BERlNldHRpbmdzLkRJU1RfRk9MREVSfS9hc3NldHMvcGRmX2ljb24uc3ZnYDtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEhlbHBlciBtZXRob2QgdG8gZ3JhYiB0aGUgaWQgZnJvbSB0aGUgaHRtbCBvYmplY3QgYW5kIHJldHVybiBhbiBpdGVtXHJcbiAgICAgKiBAcGFyYW0gaHRtbFxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIHN0YXRpYyBnZXRJdGVtRnJvbUNvbnRleHQoaHRtbDogSlF1ZXJ5PEhUTUxFbGVtZW50Pik6IEl0ZW0ge1xyXG4gICAgICAgIGNvbnN0IGlkID0gaHRtbC5kYXRhKCdlbnRpdHktaWQnKTtcclxuICAgICAgICByZXR1cm4gZ2FtZS5pdGVtcy5nZXQoaWQpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogR2V0IGFkZGl0aW9uYWwgY29udGV4dCBtZW51IGljb25zIGZvciBQREYgaXRlbXNcclxuICAgICAqIEBwYXJhbSBodG1sXHJcbiAgICAgKiBAcGFyYW0gb3B0aW9uc1xyXG4gICAgICovXHJcbiAgICBwdWJsaWMgc3RhdGljIGdldEl0ZW1Db250ZXh0T3B0aW9ucyhodG1sLCBvcHRpb25zOiBhbnlbXSkge1xyXG4gICAgICAgIG9wdGlvbnMuc3BsaWNlKDAsIDAsIHtcclxuICAgICAgICAgICAgbmFtZTogJ09wZW4gUERGJyxcclxuICAgICAgICAgICAgaWNvbjogJzxpIGNsYXNzPVwiZmFyIGZhLWZpbGUtcGRmXCI+PC9pPicsXHJcbiAgICAgICAgICAgIGNvbmRpdGlvbjogKGVudGl0eUh0bWw6IEpRdWVyeTxIVE1MRWxlbWVudD4pID0+IHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGl0ZW0gPSBQREZTZXR0aW5ncy5nZXRJdGVtRnJvbUNvbnRleHQoZW50aXR5SHRtbCk7XHJcbiAgICAgICAgICAgICAgICBpZiAoaXRlbS50eXBlICE9PSBQREZTZXR0aW5ncy5QREZfRU5USVRZX1RZUEUpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgY29uc3QgeyBjb2RlLCB1cmwgfSA9IGl0ZW0uZGF0YS5kYXRhO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGNvZGUgIT09ICcnICYmIHVybCAhPT0gJyc7XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGNhbGxiYWNrOiAoZW50aXR5SHRtbDogSlF1ZXJ5PEhUTUxFbGVtZW50PikgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgaXRlbSA9IFBERlNldHRpbmdzLmdldEl0ZW1Gcm9tQ29udGV4dChlbnRpdHlIdG1sKTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHsgY29kZSB9ID0gaXRlbS5kYXRhLmRhdGE7XHJcbiAgICAgICAgICAgICAgICBQREZvdW5kcnlBUEkub3Blbihjb2RlKTtcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICB9KTtcclxuICAgIH1cclxufVxyXG4iLCIvKiBDb3B5cmlnaHQgMjAyMCBBbmRyZXcgQ3VjY2luZWxsb1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcblxyXG5leHBvcnQgY2xhc3MgUERGVmlld2VyQmFzZSBleHRlbmRzIEFwcGxpY2F0aW9uIHtcclxuICAgIHByb3RlY3RlZCBtX0ZyYW1lOiBIVE1MSUZyYW1lRWxlbWVudDtcclxuXHJcbiAgICBzdGF0aWMgZ2V0IGRlZmF1bHRPcHRpb25zKCkge1xyXG4gICAgICAgIGNvbnN0IG9wdGlvbnMgPSBzdXBlci5kZWZhdWx0T3B0aW9ucztcclxuICAgICAgICBvcHRpb25zLmlkID0gJ3BkZi12aWV3ZXInO1xyXG4gICAgICAgIG9wdGlvbnMuY2xhc3NlcyA9IFsnYXBwJywgJ3dpbmRvdy1hcHAnXTtcclxuICAgICAgICBvcHRpb25zLnRpdGxlID0gJ1ZpZXcgUERGJztcclxuICAgICAgICBvcHRpb25zLndpZHRoID0gOC41ICogMTAwICsgNjQ7XHJcbiAgICAgICAgb3B0aW9ucy5oZWlnaHQgPSAxMSAqIDEwMCArIDY0O1xyXG4gICAgICAgIG9wdGlvbnMucmVzaXphYmxlID0gdHJ1ZTtcclxuICAgICAgICByZXR1cm4gb3B0aW9ucztcclxuICAgIH1cclxuXHJcbiAgICBwcm90ZWN0ZWQgYXN5bmMgYWN0aXZhdGVMaXN0ZW5lcnMoaHRtbDogSlF1ZXJ5PEhUTUxFbGVtZW50Pik6IFByb21pc2U8dm9pZD4ge1xyXG4gICAgICAgIHN1cGVyLmFjdGl2YXRlTGlzdGVuZXJzKGh0bWwpO1xyXG5cclxuICAgICAgICB0aGlzLm1fRnJhbWUgPSBodG1sLnBhcmVudHMoKS5maW5kKCdpZnJhbWUucGRmVmlld2VyJykuZmlyc3QoKS5nZXQoMCkgYXMgSFRNTElGcmFtZUVsZW1lbnQ7XHJcbiAgICB9XHJcblxyXG4gICAgY2xvc2UoKTogUHJvbWlzZTxhbnk+IHtcclxuICAgICAgICAvLyBAdHMtaWdub3JlXHJcbiAgICAgICAgY29uc3QgcHZhID0gdGhpcy5tX0ZyYW1lLmNvbnRlbnRXaW5kb3cuUERGVmlld2VyQXBwbGljYXRpb247XHJcbiAgICAgICAgY29uc29sZS5sb2cocHZhKTtcclxuXHJcbiAgICAgICAgcHZhLmNsZWFudXAoKTtcclxuICAgICAgICByZXR1cm4gc3VwZXIuY2xvc2UoKTtcclxuICAgIH1cclxufVxyXG4iLCIvKiBDb3B5cmlnaHQgMjAyMCBBbmRyZXcgQ3VjY2luZWxsb1xyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xyXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXHJcbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcbiAqXHJcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcclxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxyXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cclxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxyXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cclxuICovXHJcblxyXG5pbXBvcnQgeyBQREZWaWV3ZXJCYXNlIH0gZnJvbSAnLi9QREZWaWV3ZXJCYXNlJztcclxuaW1wb3J0IHsgUERGU2V0dGluZ3MgfSBmcm9tICcuLi9zZXR0aW5ncy9QREZTZXR0aW5ncyc7XHJcblxyXG5leHBvcnQgY2xhc3MgUERGVmlld2VyV2ViIGV4dGVuZHMgUERGVmlld2VyQmFzZSB7XHJcbiAgICBwcml2YXRlIG1fUGFnZTogbnVtYmVyO1xyXG4gICAgcHJpdmF0ZSBtX0ZpbGVQYXRoOiBzdHJpbmc7XHJcblxyXG4gICAgc3RhdGljIGdldCBkZWZhdWx0T3B0aW9ucygpIHtcclxuICAgICAgICBjb25zdCBvcHRpb25zID0gc3VwZXIuZGVmYXVsdE9wdGlvbnM7XHJcbiAgICAgICAgb3B0aW9ucy50ZW1wbGF0ZSA9IGBzeXN0ZW1zLyR7UERGU2V0dGluZ3MuRVhURVJOQUxfU1lTVEVNX05BTUV9L3BkZm91bmRyeS1kaXN0L3RlbXBsYXRlcy93ZWItdmlld2VyLWFwcC5odG1sYDtcclxuICAgICAgICByZXR1cm4gb3B0aW9ucztcclxuICAgIH1cclxuXHJcbiAgICBjb25zdHJ1Y3RvcihmaWxlOiBzdHJpbmcsIHBhZ2U6IG51bWJlcikge1xyXG4gICAgICAgIHN1cGVyKCk7XHJcblxyXG4gICAgICAgIHRoaXMubV9GaWxlUGF0aCA9IGVuY29kZVVSSUNvbXBvbmVudChmaWxlKTtcclxuICAgICAgICB0aGlzLm1fUGFnZSA9IHBhZ2U7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0RGF0YShvcHRpb25zPzogYW55KTogYW55IHwgUHJvbWlzZTxhbnk+IHtcclxuICAgICAgICBjb25zdCBkYXRhID0gc3VwZXIuZ2V0RGF0YShvcHRpb25zKTtcclxuICAgICAgICBkYXRhLnBhZ2UgPSB0aGlzLm1fUGFnZTtcclxuICAgICAgICBkYXRhLmZpbGVQYXRoID0gdGhpcy5tX0ZpbGVQYXRoO1xyXG4gICAgICAgIGRhdGEuc3lzdGVtTmFtZSA9IFBERlNldHRpbmdzLkVYVEVSTkFMX1NZU1RFTV9OQU1FO1xyXG4gICAgICAgIHJldHVybiBkYXRhO1xyXG4gICAgfVxyXG59XHJcbiJdfQ=="}